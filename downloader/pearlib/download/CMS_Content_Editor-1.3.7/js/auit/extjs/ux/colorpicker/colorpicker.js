Ext.namespace("Ext.ux");if(Ext.version=="3.0"){Ext.override(Ext.Element,{getColor:function(a,b,f){var d=this.getStyle(a),c=typeof f=="undefined"?"#":f,e;if(!d||/transparent|inherit/.test(d)){return b}if(/^r/.test(d)){Ext.each(d.slice(4,d.length-1).split(","),function(g){e=parseInt(g,10);c+=(e<16?"0":"")+e.toString(16)})}else{d=d.replace("#","");c+=d.length==3?d.replace(/^(\w)(\w)(\w)$/,"$1$1$2$2$3$3"):d}return(c.length>5?c.toLowerCase():b)}})}Ext.ux.ColorPicker=Ext.extend(Ext.BoxComponent,{initComponent:function(){this.applyDefaultsCP();Ext.ux.ColorPicker.superclass.initComponent.apply(this,arguments);this.addEvents("select")},onRender:function(){Ext.ux.ColorPicker.superclass.onRender.apply(this,arguments);this.body=this.body||(this.container||(this.renderTo||Ext.DomHelper.append(Ext.getBody(),{},true)));if(!this.el){this.el=this.body;if(this.cls){Ext.get(this.el).addClass(this.cls)}}this.renderComponent()},applyDefaultsCP:function(){Ext.apply(this,{cls:"x-cp-mainpanel",resizable:this.resizable||false,HSV:{h:0,s:0,v:0},updateMode:null})},renderComponent:function(){Ext.DomHelper.append(this.body,{id:this.cpGetId("rgb"),cls:"x-cp-rgbpicker"});Ext.DomHelper.append(this.body,{id:this.cpGetId("hue"),cls:"x-cp-huepicker"});this.huePicker=Ext.DomHelper.append(this.body,{cls:"x-cp-hueslider"});this.hueDD=new Ext.dd.DD(this.huePicker,"huePicker");this.hueDD.constrainTo(this.cpGetId("hue"),{top:-7,right:-3,bottom:-7,left:-3});this.hueDD.onDrag=this.moveHuePicker.createDelegate(this);Ext.get(this.cpGetId("hue")).on("mousedown",this.clickHUEPicker.createDelegate(this));Ext.get(this.huePicker).moveTo(Ext.get(this.cpGetId("hue")).getLeft()-3,Ext.get(this.cpGetId("hue")).getTop()-7);this.rgbPicker=Ext.DomHelper.append(this.body,{cls:"x-cp-rgbslider"});this.rgbDD=new Ext.dd.DD(this.rgbPicker,"rgbPicker");this.rgbDD.constrainTo(this.cpGetId("rgb"),-7);this.rgbDD.onDrag=this.moveRGBPicker.createDelegate(this);Ext.get(this.cpGetId("rgb")).on("mousedown",this.clickRGBPicker.createDelegate(this));Ext.get(this.rgbPicker).moveTo(Ext.get(this.cpGetId("rgb")).getLeft()-7,Ext.get(this.cpGetId("rgb")).getTop()-7);this.formPanel=new Ext.form.FormPanel({renderTo:Ext.DomHelper.append(this.body,{id:this.cpGetId("fCont"),cls:"x-cp-formcontainer"},true),frame:true,labelAlign:"left",labelWidth:10,forceLayout:true,items:[{layout:"column",items:[{columnWidth:0.5,layout:"form",defaultType:"numberfield",defaults:{width:30,value:0,minValue:0,maxValue:255,allowBlank:false,labelSeparator:""},items:[{fieldLabel:"R",id:this.cpGetId("iRed")},{fieldLabel:"G",id:this.cpGetId("iGreen")},{fieldLabel:"B",id:this.cpGetId("iBlue")}]},{columnWidth:0.5,layout:"form",defaultType:"numberfield",defaults:{width:30,value:0,minValue:0,maxValue:255,allowBlank:false,labelSeparator:""},items:[{fieldLabel:"H",maxValue:360,id:this.cpGetId("iHue")},{fieldLabel:"S",id:this.cpGetId("iSat")},{fieldLabel:"V",id:this.cpGetId("iVal")}]}]},{layout:"form",defaultType:"textfield",labelAlign:"left",defaults:{width:82,value:"000000",labelSeparator:"",allowBlank:false},id:this.cpGetId("cCont"),items:[{fieldLabel:"#",id:this.cpGetId("iHexa"),value:"000000"}]}]});Ext.getCmp(this.cpGetId("iRed")).on("change",this.updateFromIRGB.createDelegate(this));Ext.getCmp(this.cpGetId("iGreen")).on("change",this.updateFromIRGB.createDelegate(this));Ext.getCmp(this.cpGetId("iBlue")).on("change",this.updateFromIRGB.createDelegate(this));Ext.getCmp(this.cpGetId("iHue")).on("change",this.updateFromIHSV.createDelegate(this));Ext.getCmp(this.cpGetId("iSat")).on("change",this.updateFromIHSV.createDelegate(this));Ext.getCmp(this.cpGetId("iVal")).on("change",this.updateFromIHSV.createDelegate(this));Ext.getCmp(this.cpGetId("iHexa")).on("change",this.updateFromIHexa.createDelegate(this));Ext.DomHelper.append(this.cpGetId("cCont"),{cls:"x-cp-colorbox",id:this.cpGetId("cWebSafe")},true).update("Websafe");Ext.DomHelper.append(this.cpGetId("cCont"),{cls:"x-cp-colorbox",id:this.cpGetId("cInverse")},true).update("Inverse");Ext.DomHelper.append(this.cpGetId("cCont"),{cls:"x-cp-colorbox",id:this.cpGetId("cColor")},true).update("Pick Color");Ext.get(this.cpGetId("cWebSafe")).on("click",this.updateFromBox.createDelegate(this));Ext.get(this.cpGetId("cInverse")).on("click",this.updateFromBox.createDelegate(this));Ext.get(this.cpGetId("cColor")).on("click",this.selectColor.createDelegate(this));Ext.DomHelper.append(this.body,{tag:"br",cls:"x-cp-clearfloat"})},cpGetId:function(a){return this.getId()+"__"+(a||"cp")},updateRGBPosition:function(a,b){this.updateMode="click";a=a<0?0:a;a=a>181?181:a;b=b<0?0:b;b=b>181?181:b;this.HSV.s=this.getSaturation(a);this.HSV.v=this.getValue(b);Ext.get(this.rgbPicker).moveTo(Ext.get(this.cpGetId("rgb")).getLeft()+a-7,Ext.get(this.cpGetId("rgb")).getTop()+b-7,(this.animateMove||true));this.updateColor()},updateHUEPosition:function(a){this.updateMode="click";a=a<1?1:a;a=a>181?181:a;this.HSV.h=Math.round(360/181*(181-a));Ext.get(this.huePicker).moveTo(Ext.get(this.huePicker).getLeft(),Ext.get(this.cpGetId("hue")).getTop()+a-7,(this.animateMove||true));this.updateRGBPicker(this.HSV.h);this.updateColor()},clickRGBPicker:function(b,a){this.updateRGBPosition(b.xy[0]-Ext.get(this.cpGetId("rgb")).getLeft(),b.xy[1]-Ext.get(this.cpGetId("rgb")).getTop())},clickHUEPicker:function(b,a){this.updateHUEPosition(b.xy[1]-Ext.get(this.cpGetId("hue")).getTop())},moveRGBPicker:function(a){this.rgbDD.constrainTo(this.cpGetId("rgb"),-7);this.updateRGBPosition(Ext.get(this.rgbPicker).getLeft()-Ext.get(this.cpGetId("rgb")).getLeft()+7,Ext.get(this.rgbPicker).getTop()-Ext.get(this.cpGetId("rgb")).getTop()+7)},moveHuePicker:function(a){this.hueDD.constrainTo(this.cpGetId("hue"),{top:-7,right:-3,bottom:-7,left:-3});this.updateHUEPosition(Ext.get(this.huePicker).getTop()-Ext.get(this.cpGetId("hue")).getTop()+7)},updateRGBPicker:function(a){this.updateMode="click";Ext.get(this.cpGetId("rgb")).setStyle({"background-color":"#"+this.rgbToHex(this.hsvToRgb(a,1,1))});this.updateColor()},updateColor:function(){var b=this.hsvToRgb(this.HSV.h,this.HSV.s,this.HSV.v);var c=this.websafe(b);var d=this.invert(b);var a=this.invert(c);if(this.updateMode!=="hexa"){Ext.getCmp(this.cpGetId("iHexa")).setValue(this.rgbToHex(b))}if(this.updateMode!=="rgb"){Ext.getCmp(this.cpGetId("iRed")).setValue(b[0]);Ext.getCmp(this.cpGetId("iGreen")).setValue(b[1]);Ext.getCmp(this.cpGetId("iBlue")).setValue(b[2])}if(this.updateMode!=="hsv"){Ext.getCmp(this.cpGetId("iHue")).setValue(Math.round(this.HSV.h));Ext.getCmp(this.cpGetId("iSat")).setValue(Math.round(this.HSV.s*100));Ext.getCmp(this.cpGetId("iVal")).setValue(Math.round(this.HSV.v*100))}Ext.get(this.cpGetId("cColor")).setStyle({background:"#"+this.rgbToHex(b),color:"#"+this.rgbToHex(d)});Ext.getDom(this.cpGetId("cColor")).title="#"+this.rgbToHex(b);Ext.get(this.cpGetId("cInverse")).setStyle({background:"#"+this.rgbToHex(d),color:"#"+this.rgbToHex(b)});Ext.getDom(this.cpGetId("cInverse")).title="#"+this.rgbToHex(d);Ext.get(this.cpGetId("cWebSafe")).setStyle({background:"#"+this.rgbToHex(c),color:"#"+this.rgbToHex(a)});Ext.getDom(this.cpGetId("cWebSafe")).title="#"+this.rgbToHex(c);Ext.get(this.huePicker).moveTo(Ext.get(this.huePicker).getLeft(),Ext.get(this.cpGetId("hue")).getTop()+this.getHPos(Ext.getCmp(this.cpGetId("iHue")).getValue())-7,(this.animateMove||true));Ext.get(this.rgbPicker).moveTo(Ext.get(this.cpGetId("rgb")).getLeft()+this.getSPos(Ext.getCmp(this.cpGetId("iSat")).getValue()/100)-7,Ext.get(this.cpGetId("hue")).getTop()+this.getVPos(Ext.getCmp(this.cpGetId("iVal")).getValue()/100)-7,(this.animateMove||true));Ext.get(this.cpGetId("rgb")).setStyle({"background-color":"#"+this.rgbToHex(this.hsvToRgb(Ext.getCmp(this.cpGetId("iHue")).getValue(),1,1))})},setColor:function(a){if(!/^[0-9a-fA-F]{6}$/.test(a)){return}Ext.getCmp(this.cpGetId("iHexa")).setValue(a);this.updateFromIHexa()},updateFromIRGB:function(b,d,c){this.updateMode="rgb";var a=this.rgbToHsv(Ext.getCmp(this.cpGetId("iRed")).getValue(),Ext.getCmp(this.cpGetId("iGreen")).getValue(),Ext.getCmp(this.cpGetId("iBlue")).getValue());this.HSV={h:a[0],s:a[1],v:a[2]};this.updateColor()},updateFromIHSV:function(a,c,b){this.updateMode="hsv";this.HSV={h:Ext.getCmp(this.cpGetId("iHue")).getValue(),s:Ext.getCmp(this.cpGetId("iSat")).getValue()/100,v:Ext.getCmp(this.cpGetId("iVal")).getValue()/100};this.updateColor()},updateFromIHexa:function(b,d,c){this.updateMode="hexa";var a=this.rgbToHsv(this.hexToRgb(Ext.getCmp(this.cpGetId("iHexa")).getValue()));this.HSV={h:a[0],s:a[1],v:a[2]};this.updateColor()},updateFromBox:function(c,b){this.updateMode="click";var a=this.rgbToHsv(this.hexToRgb(Ext.get(b).getColor("backgroundColor","","")));this.HSV={h:a[0],s:a[1],v:a[2]};this.updateColor()},selectColor:function(b,a){this.fireEvent("select",this,Ext.get(a).getColor("backgroundColor","",""))},hsvToRgb:function(j,u,n){if(j instanceof Array){return this.hsvToRgb.call(this,j[0],j[1],j[2])}var a,k,m,e,l,d,c,o;e=Math.floor((j/60)%6);l=(j/60)-e;d=n*(1-u);c=n*(1-l*u);o=n*(1-(1-l)*u);switch(e){case 0:a=n;k=o;m=d;break;case 1:a=c;k=n;m=d;break;case 2:a=d;k=n;m=o;break;case 3:a=d;k=c;m=n;break;case 4:a=o;k=d;m=n;break;case 5:a=n;k=d;m=c;break}return[this.realToDec(a),this.realToDec(k),this.realToDec(m)]},rgbToHsv:function(a,e,f){if(a instanceof Array){return this.rgbToHsv.call(this,a[0],a[1],a[2])}a=a/255;e=e/255;f=f/255;var c,i,k,d,l,j;c=Math.min(Math.min(a,e),f);i=Math.max(Math.max(a,e),f);k=i-c;switch(i){case c:d=0;break;case a:d=60*(e-f)/k;if(e<f){d+=360}break;case e:d=(60*(f-a)/k)+120;break;case f:d=(60*(a-e)/k)+240;break}l=(i===0)?0:1-(c/i);return[Math.round(d),l,i]},realToDec:function(a){return Math.min(255,Math.round(a*256))},rgbToHex:function(d,c,a){if(d instanceof Array){return this.rgbToHex.call(this,d[0],d[1],d[2])}return this.decToHex(d)+this.decToHex(c)+this.decToHex(a)},decToHex:function(b){var a="0123456789ABCDEF";b=parseInt(b,10);b=(!isNaN(b))?b:0;b=(b>255||b<0)?0:b;return a.charAt((b-b%16)/16)+a.charAt(b%16)},getHCharPos:function(b){b=b||"";var a="0123456789ABCDEF";return a.indexOf(b.toUpperCase())},hexToDec:function(b){var a=b.split("");return((this.getHCharPos(a[0])*16)+this.getHCharPos(a[1]))},hexToRgb:function(a){return[this.hexToDec(a.substr(0,2)),this.hexToDec(a.substr(2,2)),this.hexToDec(a.substr(4,2))]},getHue:function(b){var a=360-Math.round(((181-b)/181)*360);return a===360?0:a},getHPos:function(a){return 181-a*(181/360)},getSaturation:function(a){return a/181},getSPos:function(a){return a*181},getValue:function(a){return(181-a)/181},getVPos:function(a){return 181-(a*181)},checkSafeNumber:function(a){if(!isNaN(a)){a=Math.min(Math.max(0,a),255);var b,c;for(b=0;b<256;b=b+51){c=b+51;if(a>=b&&a<=c){return(a-b>25)?c:b}}}return a},websafe:function(d,c,a){if(d instanceof Array){return this.websafe.call(this,d[0],d[1],d[2])}return[this.checkSafeNumber(d),this.checkSafeNumber(c),this.checkSafeNumber(a)]},invert:function(d,c,a){if(d instanceof Array){return this.invert.call(this,d[0],d[1],d[2])}return[255-d,255-c,255-a]}});Ext.ux.ColorDialog=Ext.extend(Ext.Window,{initComponent:function(){this.width=(!this.width||this.width<353)?353:this.width;this.applyDefaultsCP();Ext.ux.ColorDialog.superclass.initComponent.apply(this,arguments)},onRender:function(){Ext.ux.ColorDialog.superclass.onRender.apply(this,arguments);this.renderComponent()}});Ext.applyIf(Ext.ux.ColorDialog.prototype,Ext.ux.ColorPicker.prototype);Ext.ux.ColorPanel=Ext.extend(Ext.Panel,{initComponent:function(){this.width=(!this.width||this.width<300)?300:this.width;this.applyDefaultsCP();Ext.ux.ColorPanel.superclass.initComponent.apply(this,arguments)},onRender:function(){Ext.ux.ColorPanel.superclass.onRender.apply(this,arguments);this.renderComponent()}});Ext.applyIf(Ext.ux.ColorPanel.prototype,Ext.ux.ColorPicker.prototype);Ext.reg("colorpicker",Ext.ux.ColorPicker);Ext.reg("colordialog",Ext.ux.ColorDialog);Ext.reg("colorpanel",Ext.ux.ColorPanel);