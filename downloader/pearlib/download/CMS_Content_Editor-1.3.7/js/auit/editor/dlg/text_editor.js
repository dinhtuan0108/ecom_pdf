Ext.namespace("AuIt.Editor.dlg");AuIt.Editor.dlg.cssEditor=Ext.extend(AuIt.ModalWindow,{id:"AuIt.Editor.dlg.cssEditor",title:AuIt.locale.CSSED_title,width:400,height:250,minWidth:300,minHeight:250,layout:"fit",onOK:function(){if(this.get(0).getForm().isValid()){var c=this.get(0).getForm();var b=AuIt.App.getActionMgr().getAction("CREATETEMPLATE","Css");b.cfg={};var a=c.getFieldValues();Ext.apply(b.cfg,c.getFieldValues());b.cfg.key=this.cfg.key;b.executeCmd()}},initComponent:function(){var a,d=AUIT_EDITOR.styles,b=[],c=[];for(a in d){if(d.hasOwnProperty(a)){if(!c[d[a].menu]){c[d[a].menu]=1;b.push(d[a].menu)}}}this.items=new Ext.form.FormPanel({baseCls:"x-plain",layout:"fit",items:{xtype:"tabpanel",activeTab:0,defaults:{bodyStyle:"padding:5px"},items:[{title:AuIt.locale.CSSED_Definition,layout:"form",baseCls:"x-plain",defaults:{xtype:"textfield",anchor:"100%",allowBlank:false},items:[{fieldLabel:AuIt.locale.CSSED_Name,name:"name"},{allowBlank:false,fieldLabel:AuIt.locale.CSSED_Category,xtype:"combo",triggerAction:"all",store:b,name:"menu"},{allowBlank:true,fieldLabel:AuIt.locale.CSSED_Image,xtype:"auit-field-image",rootID:AUIT_EDITOR.file_browser_root.preview,directive_mask:AUIT_EDITOR.file_browser_root.preview_directive,useRelative:true,name:"image"},{fieldLabel:AuIt.locale.CSSED_Description,allowBlank:true,xtype:"textarea",anchor:"100% -85",name:"description"}]},{title:AuIt.locale.CSSED_Details,layout:"form",baseCls:"x-plain",labelWidth:50,labelAlign:"top",defaults:{xtype:"textfield",anchor:"100%"},items:[{fieldLabel:AuIt.locale.CSSED_Classname,name:"classname"},{fieldLabel:AuIt.locale.CSSED_Style,name:"style"}]}]}});Ext.applyIf(this.cfg,{menu:"",name:"",image:"",description:"",style:"",classname:""});this.items.getForm().setValues(this.cfg);AuIt.Editor.dlg.cssEditor.superclass.initComponent.apply(this,arguments)}});AuIt.Editor.dlg.pagePartEditor=Ext.extend(AuIt.ModalWindow,{id:"AuIt.Editor.dlg.pagePartEditor",title:AuIt.locale.PP_title,width:400,height:270,minWidth:300,minHeight:270,layout:"fit",getStruct:function(){return AUIT_EDITOR.templates},getCreateAction:function(){return AuIt.App.getActionMgr().getAction("CREATETEMPLATE","PageParts")},onOK:function(){if(this.get(0).getForm().isValid()){var c=this.get(0).getForm();var d,b=this.getCreateAction();b.cfg={};for(var a in this.cfg){if(a.indexOf("ext-comp")<0){b.cfg[a]=this.cfg[a]}}c.items.each(function(e){d=e.getName();if(d.indexOf("ext-comp")<0){if(e.xtype=="datefield"){b.cfg[d]=""+e.getValue()}else{b.cfg[d]=""+e.getValue()}}});b.cfg.key=this.cfg.key;b.executeCmd();return true}return false},initComponent:function(){var a,d=this.getStruct(),b=[],c=[];for(a in d){if(d.hasOwnProperty(a)){if(!c[d[a].menu]){c[d[a].menu]=1;b.push(d[a].menu)}}}this.items=new Ext.form.FormPanel({baseCls:"x-plain",layout:"fit",items:{xtype:"tabpanel",activeTab:0,defaults:{bodyStyle:"padding:5px"},items:[{title:AuIt.locale.PP_Definition,layout:"form",baseCls:"x-plain",defaults:{xtype:"textfield",anchor:"100%",allowBlank:false},items:[{fieldLabel:AuIt.locale.PP_Name,name:"name"},{allowBlank:false,fieldLabel:AuIt.locale.PP_Category,xtype:"combo",triggerAction:"all",store:b,name:"menu"},{allowBlank:true,fieldLabel:AuIt.locale.PP_Image,xtype:"auit-field-image",rootID:AUIT_EDITOR.file_browser_root.preview,directive_mask:AUIT_EDITOR.file_browser_root.preview_directive,useRelative:true,name:"image"},{fieldLabel:AuIt.locale.PP_Description,allowBlank:true,xtype:"textarea",anchor:"100% -85",name:"description"}]},{title:AuIt.locale.PP_Details,layout:"form",labelWidth:50,labelAlign:"top",baseCls:"x-plain",items:[{fieldLabel:AuIt.locale.PP_Template,allowBlank:true,xtype:"ux-codemirror",codeMirrorPath:AUIT_EDITOR.js_url+"auit/editor/codemirror",language:"html",anchor:"100% 100%",name:"template"}]}]}});Ext.applyIf(this.cfg,{menu:"",name:"",image:"",description:"",style:"",classname:""});this.items.getForm().setValues(this.cfg);AuIt.Editor.dlg.pagePartEditor.superclass.initComponent.apply(this,arguments)}});AuIt.Editor.dlg.widgetEditor=Ext.extend(AuIt.Editor.dlg.pagePartEditor,{id:"AuIt.Editor.dlg.widgetEditor",title:AuIt.locale.WE_title,getStruct:function(){return AUIT_EDITOR.widgets},getCreateAction:function(){return AuIt.App.getActionMgr().getAction("CREATETEMPLATE","Widget")}});AuIt.Editor.dlg.blocksEditor=Ext.extend(AuIt.Editor.dlg.pagePartEditor,{minWidth:500,width:500,id:"AuIt.Editor.dlg.blocksEditor",getStruct:function(){return AUIT_EDITOR.blocks},getCreateAction:function(){return AuIt.App.getActionMgr().getAction("CREATETEMPLATE","Blocks")},initComponent:function(){var d=new AuIt.ArrayCombo({fieldLabel:AuIt.locale.WE_Reference,name:"reference",options:this.cfg.blockoption});var e=new AuIt.ArrayCombo({fieldLabel:AuIt.locale.WE_SBlock,name:"classname",options:this.cfg.staticblocks});var b=new AuIt.ArrayCombo({fieldLabel:AuIt.locale.WE_Template,name:"template",options:this.cfg.templates});var a={fieldLabel:AuIt.locale.WE_ShowAt,name:"opt_showat",xtype:"multiCombo",value:"0",multiselect:true,mode:"local",typeAhead:true,triggerAction:"all",lazyRender:true,valueField:"value",displayField:"text",options:this.cfg.showat,allowBlank:true,store:new Ext.data.ArrayStore({xtype:"arraystore",id:0,fields:["value","text"],data:this.cfg.showat})};var f={fieldLabel:AuIt.locale.WE_ScheduleAt,name:"opt_scheduleat",xtype:"GroupingComboBox",value:"0",multiselect:true,mode:"local",typeAhead:true,triggerAction:"all",lazyRender:true,groupField:"group",valueField:"value",displayField:"text",allowBlank:true,options:this.cfg.showat,store:new Ext.data.ArrayStore({fields:["group","text","value"],data:this.cfg.scheduleat})};var c={title:AuIt.locale.WE_Option,layout:"form",baseCls:"x-plain",defaults:{xtype:"textfield",anchor:"100%",allowBlank:false},items:[a,{xtype:"fieldset",columnWidth:0.5,title:AuIt.locale.WE_Schedule,collapsible:true,autoHeight:true,defaults:{anchor:"-20",border:false,frame:false},items:[f,{layout:"column",items:[{columnWidth:0.5,layout:"form",border:false,frame:false,items:[{xtype:"auit_datefield",name:"opt_startdate",fieldLabel:AuIt.locale.WE_Schedule_StartDate,anchor:"95%"},{xtype:"auit_timefield",name:"opt_starttime",fieldLabel:AuIt.locale.WE_Schedule_StartTime,anchor:"95%"}]},{columnWidth:0.5,layout:"form",border:false,frame:false,items:[{xtype:"auit_datefield",name:"opt_enddate",fieldLabel:AuIt.locale.WE_Schedule_EndDate,anchor:"95%"},{xtype:"auit_timefield",name:"opt_endtime",fieldLabel:AuIt.locale.WE_Schedule_EndTime,anchor:"95%"}]}]}]}]};this.items=new Ext.form.FormPanel({baseCls:"x-plain",layout:"fit",items:{xtype:"tabpanel",activeTab:0,defaults:{bodyStyle:"padding:5px"},items:[{title:AuIt.locale.WE_Definition,layout:"form",baseCls:"x-plain",defaults:{xtype:"textfield",anchor:"100%",allowBlank:false},items:[{fieldLabel:AuIt.locale.WE_Name,name:"name"},d,b,e,new Ext.ux.form.SpinnerField({fieldLabel:AuIt.locale.WE_SOrder,name:"sort_order",minValue:1}),{fieldLabel:AuIt.locale.WE_CClass,name:"blockclass",allowBlank:true}]},c]}});this.title=AuIt.Editor.utils.isEditFktT("e");this.y=1;Ext.applyIf(this.cfg,{menu:"",name:"",image:"",description:"",style:"",classname:""});this.items.getForm().setValues(this.cfg);AuIt.Editor.dlg.pagePartEditor.superclass.initComponent.apply(this,arguments)}});AuIt.Editor.dlg.menusEditor=Ext.extend(AuIt.Editor.dlg.pagePartEditor,{id:"AuIt.Editor.dlg.menusEditor",getStruct:function(){return AUIT_EDITOR.menus},getCreateAction:function(){return AuIt.App.getActionMgr().getAction("CREATETEMPLATE","Menus")},initComponent:function(){var b=new AuIt.ArrayCombo({fieldLabel:AuIt.locale.ME_Reference,name:"reference",options:this.cfg.menutags});var a=[];a.push({fieldLabel:AuIt.locale.ME_MName,name:"name"});a.push(b);if(this.cfg.storefield){a.push(this.cfg.storefield)}a.push(new AuIt.Editor.htmlProperty.GridEditor.href({fieldLabel:AuIt.locale.ME_Link,name:"href",getValue:function(){return this.value}}));a.push({fieldLabel:AuIt.locale.ME_ToolTip,name:"title",allowBlank:true});a.push(new Ext.ux.form.SpinnerField({fieldLabel:AuIt.locale.ME_SOrder,name:"sort_order",minValue:1}));this.items=new Ext.form.FormPanel({baseCls:"x-plain",layout:"fit",items:{xtype:"tabpanel",activeTab:0,defaults:{bodyStyle:"padding:5px"},items:[{title:AuIt.locale.ME_Definition,layout:"form",baseCls:"x-plain",defaults:{xtype:"textfield",anchor:"100%",allowBlank:false},items:a}]}});this.title=AuIt.Editor.utils.isEditFktT("d");this.y=1;Ext.applyIf(this.cfg,{menu:"",name:"",image:"",description:"",style:"",classname:""});this.items.getForm().setValues(this.cfg);AuIt.Editor.dlg.pagePartEditor.superclass.initComponent.apply(this,arguments)}});AuIt.Editor.dlg.TextEditor=Ext.extend(AuIt.ModalWindow,{title:AuIt.locale.TxtEd_title,modal:true,width:700,height:400,layout:"fit",focus:function(){this.get(0).focus()},onApply:function(a){},onOK:function(){this.onApply(this.get(0).getValue())},initComponent:function(){this.items={border:false,frame:false,xtype:"textarea",value:this.textValue};AuIt.Editor.dlg.TextEditor.superclass.initComponent.apply(this,arguments)}});AuIt.Editor.dlg.HTMLEditor=Ext.extend(AuIt.ModalWindow,{title:AuIt.locale.HTMLEd_title,modal:true,width:700,height:400,layout:"fit",editorLanguage:"html",useAPLLYBUTTON:true,onOK:function(){this.applyText(true)},onApply:function(){this.applyText(false)},initComponent:function(){this.items={xtype:"ux-codemirror",codeMirrorPath:AUIT_EDITOR.js_url+"auit/editor/codemirror",language:this.editorLanguage,value:""};AuIt.Editor.dlg.HTMLEditor.superclass.initComponent.apply(this,arguments);var a=AuIt.App.getActionMgr().getAction("INTERN_GETBLOCKDATA");a.browser=this;this.ElementData=null;a.quest(this.editor.proxy,function(b){this.ElementData=b.data;AuIt.App.getActionMgr().request(b,{directCall:true,url:AUIT_EDITOR.web_cmd_url,waitMsg:AuIt.locale.HTMLEd_PW,waitWnd:this.el,params:{action:"translate_html_to_local",data:b.data},LoadSuccess:function(d,e){if(d.data){var c=AuIt.Editor.utils.formatHTMLFragment(d.data.content);this.browser.get(0).setValue(c?c:"");this.browser=null}}})},this)},applyText:function(b){var a={itemId:"TRANSLATE_LOCAL_TO_HTML",browser:this,_data:[],addSaveData:function(c){this._data=c}};a._data=this.ElementData;a._data.local=this.get(0).getValue();AuIt.App.getActionMgr().request(a,{directCall:true,url:AUIT_EDITOR.web_cmd_url,waitMsg:AuIt.locale.HTMLEd_PW,waitWnd:this.el,params:{action:"translate_local_to_html",data:a._data},LoadSuccess:function(c,d){if(c.data){var e=AuIt.App.getActionMgr().getAction("INTERN_SETBLOCKDATA");e.data=c.data;e.executeCmd();if(b){this.browser.close()}}}})}});AuIt.Editor.dlg.BlockEditor=Ext.extend(AuIt.ModalWindow,{title:AuIt.locale.BLEd_title,layout:"fit",onOK:function(){this.applyText(true)},initComponent:function(){this.textArea=new Ext.form.TextArea({border:false,frame:false,value:this.propertyBasis.pagedata.data.data.source});this.previewBox=new AuIt.Panel.Iframe();this.items={layout:"border",useshim:true,items:[{border:false,region:"center",title:AuIt.locale.BLEd_Preview,layout:"fit",items:this.previewBox},{tbar:[{text:AuIt.locale.BLEd_Preview,iconCls:"page-cms-inline-16",tooltip:AuIt.locale.BLEd_CPreview,handler:this.createPreview,scope:this}],border:false,region:"south",title:AuIt.locale.BLEd_Source,layout:"fit",split:true,collapseMode:"mini",height:150,minSize:75,maxSize:250,items:this.textArea}]};AuIt.Editor.dlg.BlockEditor.superclass.initComponent.apply(this,arguments);this.on("show",function(){this.createPreview()},this)},createPreview:function(){var a=this.propertyBasis.mainPageData;var b={action:"block_preview",page_id:a.page_id,factory:a.factory,storeId:a.storeId,data:this.textArea.getValue()};this.previewBox.setLocation(AUIT_EDITOR.web_cmd_url+"&"+Ext.urlEncode(b))},applyText:function(c){var b={itemId:"TRANSLATE_BLOCK_TO_HTML",browser:this};var a=this.propertyBasis.pagedata;AuIt.App.getActionMgr().request(b,{directCall:true,url:AUIT_EDITOR.web_cmd_url,waitMsg:AuIt.locale.BLEd_PW,waitWnd:this.el,propertyPanel:this.propertyBasis,params:{action:"translate_block_to_html",page_id:a.page_id,factory:a.factory,storeId:a.storeId,data:this.textArea.getValue()},LoadSuccess:function(d,e){if(d.data){var f=AuIt.App.getActionMgr().getAction("INTERN_REPLACEHTMLBLOCK","Editor");f.data={DomID:e.propertyPanel.DomID,pagedata:e.propertyPanel.pagedata,xhtml:d.data.xhtml};f.executeCmd();if(c){this.browser.close()}}}})}});Ext.ux.form.CodeMirror=Ext.extend(Ext.form.TextArea,{language:"txt",layout:"fit",codeMirrorPath:null,initComponent:function(){if(this.codeMirrorPath===null){throw"Ext.ux.form.CodeMirror: codeMirrorPath required"}this.initialized=false;Ext.ux.form.CodeMirror.superclass.initComponent.apply(this,arguments);this.addEvents("initialize");this.on({resize:function(b,c,a){if(this.initialized){Ext.get(this.codeEditor.frame).setSize(c-(40+11),a)}else{this.lw=c;this.lh=a}},afterrender:function(){var b,a;switch(this.language.toLowerCase()){case"css":b="parsecss.js";a=this.codeMirrorPath+"/css/csscolors.css";break;case"js":b=["tokenizejavascript.js","parsejavascript.js"];a=this.codeMirrorPath+"/css/jscolors.css";break;case"php":b=["parsexml.js","parsecss.js","tokenizejavascript.js","parsejavascript.js","../contrib/php/js/tokenizephp.js","../contrib/php/js/parsephp.js","../contrib/php/js/parsephphtmlmixed.js"];a=[this.codeMirrorPath+"/css/xmlcolors.css",this.codeMirrorPath+"/css/jscolors.css",this.codeMirrorPath+"/css/csscolors.css",this.codeMirrorPath+"/contrib/php/css/phpcolors.css"];break;case"htm":case"html":case"xml":b="parsexml.js";a=this.codeMirrorPath+"/css/xmlcolors.css";break;default:b="parsedummy.js";a="";break}(function(){var c=this;this.codeEditor=new CodeMirror.fromTextArea(c.id,{parserfile:b,stylesheet:a,path:c.codeMirrorPath+"/js/",textWrapping:false,lineNumbers:true,iframeClass:"codemirror-iframe "+c.id,content:this.value,initCallback:function(d){c.initialized=true;c.fireEvent("initialize",true);Ext.get(d.frame).setSize(c.lw-(40+11),c.lh);if(this.content!=c.value&&c.value!==undefined){c.codeEditor.setCode(c.value)}c=null}})}).defer(10,this)}})},getValue:function(){if(this.initialized){return this.codeEditor.getCode()}return this.value},setValue:function(a){if(this.initialized){this.codeEditor.setCode(a);this.value=this.codeEditor.getCode()}else{this.value=a}},validate:function(){this.getValue();return Ext.ux.form.CodeMirror.superclass.validate.apply(this,arguments)}});Ext.reg("ux-codemirror",Ext.ux.form.CodeMirror);AuIt.Editor.Dialog=function(){var c,b,d,a;return{link:function(g,f){if(!c){c=new AuIt.Editor.LinkBrowser()}c.cfg=f;c.show();c.field=c.cfg.field||null;var e=AuIt.App.getActiveEditor();if(!e||e.pageData.STORE_ID!=c.treeCategory.root.attributes.storeID){c.treeCategory.getSelectionModel().clearSelections();c.treeCategory.root.attributes.storeID=e?e.pageData.STORE_ID:null;c.treeCategory.root.reload()}if(f.directive){c.fields.Adress.setDirective(f.directive)}},Widget:function(f,e){if(!b){b=new AuIt.Editor.dlg.Widget()}if(e.onOKInsert){b.onOKInsert=e.onOKInsert}else{b.onOKInsert=function(){}}b.initTemplate=e.initTemplate?e.initTemplate:"";b.show()},Blocks:function(f,e){if(!d){d=new AuIt.Editor.dlg.Blocks()}d.show()},Menus:function(f,e){if(!a){a=new AuIt.Editor.dlg.Menus()}a.show()},Message:function(e){Ext.MessageBox.alert("-",e)}}}();