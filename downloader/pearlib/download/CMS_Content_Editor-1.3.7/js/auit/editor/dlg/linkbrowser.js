Ext.namespace("AuIt.Editor","AuIt.Editor.dlg");AuIt.Editor.dlg.Blocks=Ext.extend(AuIt.ModalWindow,{id:"AuIt.Editor.dlg.Blocks",modal:true,closeAction:"hide",layout:"fit",onApply:function(){var a=AuIt.App.getActiveEditor();if(a){a.reload()}},initComponent:function(){this.title=AuIt.Editor.utils.isEditFktT("a");var a=new AuIt.Editor.Gallery.Blocks({title:null,dlg:this,onClick:function(b){}});this.y=1;this.items=a;AuIt.Editor.dlg.Blocks.superclass.initComponent.apply(this,arguments)}});AuIt.Editor.dlg.Menus=Ext.extend(AuIt.ModalWindow,{id:"AuIt.Editor.dlg.Menus",modal:true,closeAction:"hide",layout:"fit",onApply:function(){var a=AuIt.App.getActiveEditor();if(a){a.reload()}},initComponent:function(){this.title=AuIt.Editor.utils.isEditFktT("b");var a=new AuIt.Editor.Gallery.Menus({title:null,dlg:this,onClick:function(b){}});this.y=1;this.items=a;AuIt.Editor.dlg.Menus.superclass.initComponent.apply(this,arguments)}});AuIt.Editor.dlg.Widget=Ext.extend(AuIt.ModalWindow,{id:"AuIt.Editor.dlg.Widget",modal:true,width:1140,text_APPLY:AuIt.locale.LNKBR_APPLY,useAPLLYBUTTON:true,closeAction:"hide",fields:{},oninsertWidget:function(a){if(this.currentWidget){this.currentWidget.template=a;if(this.onFinishHandler){this.onFinishHandler()}}},onFrameLoaded:function(a){this.setInitialValue()},setInitialValue:function(){if(this.initTemplate){this.currentWidget=null;var d=this.initTemplate;if(d.indexOf("{{widget")!=-1){var c="";var a=d.match(/([a-z0-9\_]+)\s*\=\s*[\"\']([^\"\']+)[\"\']/gi);if(a){Ext.each(a,function(e){var f=e.match(/([a-z0-9\_]+)\s*\=\s*[\"\']{1}([^\"\']+)[\"\']{1}/i);if(f[1]=="type"){c=f[2];return false}})}if(c&&AUIT_EDITOR.widgets&&AUIT_EDITOR.widgets[c]){this.currentWidget=AUIT_EDITOR.widgets[c];this.currentWidget.template=d}else{this.currentWidget={description:"Unknown",template:d}}}this.initTemplate=null}try{if(this.currentWidget&&this.iframe.iframe.contentWindow.wWidget){this.iframe.iframe.contentWindow.wWidget.setOptionExt(this.currentWidget)}}catch(b){}},buildWidget:function(){try{if(this.currentWidget){this.iframe.iframe.contentWindow.wWidget.insertcallback=this.oninsertWidget;this.iframe.iframe.contentWindow.wWidget.insertscope=this;this.iframe.iframe.contentWindow.wWidget.insertWidget();return true}}catch(a){}return false},onOKInsert:function(a){},onOKFinish:function(){this.onOKInsert(this.currentWidget);this[this.closeAction]()},onOK:function(){this.onFinishHandler=this.onOKFinish;this.buildWidget();return false},onApplyFinish:function(){this[this.closeAction]();var a=AuIt.App.getActionMgr().getAction("ADDFROM","PageParts");a.value=Ext.ux.clone(this.currentWidget);a.value.menu="Widgets";a.executeCmd()},onApply:function(){this.onFinishHandler=this.onApplyFinish;this.buildWidget()},oncreatePreviewFinish:function(){var d=Ext.ux.clone(this.currentWidget);var c={};var a=AuIt.App.getActiveEditor();if(a){c=a.pageData}var b={action:"block_preview",page_id:c.page_id,factory:c.factory,storeId:c.storeId,data:this.currentWidget.template};this.previewBox.setLocation(AUIT_EDITOR.web_cmd_url+"&"+Ext.urlEncode(b));AuIt.App.getActionMgr().hideWaitBox()},oncreatePreview:function(){this.onFinishHandler=this.oncreatePreviewFinish;this.buildWidget()},initComponent:function(){this.iframe=new AuIt.Editor.LinkBrowserIFrame({browser:this});var b=new AuIt.Editor.Gallery.Widgets({title:null,dlg:this,onClick:function(c){try{this.dlg.currentWidget=c;this.dlg.iframe.iframe.contentWindow.wWidget.setOptionExt(c)}catch(d){}}});this.previewBox=new AuIt.Panel.Iframe();var a=Ext.apply(this.initialConfig,{title:AuIt.Editor.utils.isEditFktT("c"),layout:"border",y:1,items:[{region:"west",border:false,frame:false,width:227,autoScroll:false,layout:"fit",split:true,collapseMode:"mini",items:[b]},{border:false,frame:false,region:"center",layout:"fit",items:{border:false,frame:false,layout:"border",items:[{border:false,frame:false,region:"center",layout:"fit",items:this.iframe},{border:false,frame:false,split:true,collapseMode:"mini",width:330,tbar:[{text:AuIt.locale.LNKBR_Preview,iconCls:"page-cms-inline-16",tooltip:AuIt.locale.LNKBR_CPreview,handler:this.oncreatePreview,scope:this}],region:"east",border:false,frame:false,layout:"fit",items:this.previewBox}]}}]});Ext.apply(this,a);AuIt.Editor.dlg.Widget.superclass.initComponent.apply(this,arguments)},onStartEnd:function(a){if(a&&!this.notInit){this.notInit=true;(function(){this.iframe.setLocation(AUIT_EDITOR.editor_cmd_url+"&action=widget-frame")}).defer(10,this)}if(a){this.currentWidget=null;this.setInitialValue()}}});AuIt.Editor.LinkBrowserIFrame=Ext.extend(AuIt.Panel.Iframe,{onFrameLoaded:function(a){this.doc=this.getDoc();this.win=this.getWin();this.browser.onFrameLoaded(this)}});AuIt.Editor.LinkBrowser=Ext.extend(AuIt.ModalWindow,{dataUrl:"",modal:true,closeAction:"hide",fields:{},onFrameLoaded:function(c){try{var a=""+c.win;if(c.win.AUIT_PAGEDATA&&c.win.AUIT_PAGEDATA.STORE_URL){this.fields.Adress.urlX=c.win.location.href;this.fields.Adress.setValue(c.win.AUIT_PAGEDATA.STORE_URL);this.fields.Adress.urlstamp=c.win.AUIT_PAGEDATA.STORE_URL;return}}catch(f){}try{var b=""+c.win.location;if(b!="about:blank"){this.fields.Adress.urlX=b;this.fields.Adress.setValue(b);this.fields.Adress.urlstamp=b}}catch(d){}},onApply:function(){if(this.cfg.onApply){var a=this.fields.Adress.getValue();var b=[];b.push({directive:a,url:(a==this.fields.Adress.urlstamp)?this.fields.Adress.urlX:a});this.cfg.onApply.call(this,b,this.cfg)}else{alert("linkDialog no finish handler")}},initComponent:function(){this.dataUrl=AUIT_EDITOR.link_dlg_url;var b=this;this.treeCategory=new AuIt.Editor.Tree.category({shortMenu:true,onClick:function(c,d){b.iframe.setLocation(this.getClickUrl(c))}});this.tree=new AuIt.Editor.Tree.cmsPage({shortMenu:true,onClick:function(c,d){b.iframe.setLocation(this.getClickUrl(c))}});this.special=new AuIt.Editor.Tree.specialLinks({shortMenu:true,onClick:function(c,d){b.iframe.setLocation(this.getClickUrl(c))}});this.iframe=new AuIt.Editor.LinkBrowserIFrame({browser:this});this.fields.Adress=new Ext.ux.form.SearchField({browser:this,onTrigger1Click:function(){},onTrigger2Click:function(){var c=this.getRawValue();if(c.length<1){this.onTrigger1Click();return}this.setDirective(c)},listeners:{change:{fn:function(e,d,c){}}},setDirective:function(c){if(c=="##GOHOME##"){if(this.urlstamp){return}c="{{store direct_url=''}}"}if(this.urlstamp==c){return}this.urlX="";this.setValue(c);this.urlstamp=c;AuIt.App.getActionMgr().request({itemId:"LINK_BROWSER_NAVTO",browser:this.browser},{directCall:true,url:this.browser.dataUrl,waitMsg:true,waitWnd:this.el,params:{action:"translate",directive:c},LoadSuccess:function(d,e){if(d.info&&d.info.url){this.browser.iframe.setLocation(d.info.url)}}})}});var a=Ext.apply(this.initialConfig,{title:AuIt.locale.LNKBR_LB,layout:"border",items:[{region:"north",border:false,frame:false,split:false,height:22,layout:"fit",items:[this.fields.Adress]},{region:"west",tbar:AuIt.App.getActionMgr().getToolBar("CMS","Short"),border:false,frame:false,width:150,autoScroll:true,split:true,collapseMode:"mini",items:[this.tree,this.treeCategory,this.special]},{border:false,frame:false,region:"center",layout:"fit",items:this.iframe}]});Ext.apply(this,a);AuIt.Editor.LinkBrowser.superclass.initComponent.apply(this,arguments)}});