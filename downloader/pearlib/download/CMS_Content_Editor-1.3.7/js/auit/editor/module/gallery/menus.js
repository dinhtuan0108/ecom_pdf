Ext.namespace("AuIt.Action.ToolBar.Menus","AuIt.Action.Menus","AuIt.Action.menu");AuIt.Action.menu.MAIN={text:AuIt.locale.menu_MAINM,tooltip:AuIt.locale.menu_MAINT,disabled:false,executeCmd:function(){AuIt.Editor.Dialog.Menus(this,{})},scale:"small",iconCls:"menu-mainmenu-16",itemId:"MENU_MAIN"};AuIt.Action.ToolBar.Menus.GALLERY=function(a){return new Ext.Toolbar({items:[a.getAction("ADD","Menus"),a.getAction("EDIT","Menus"),"-",a.getAction("DEL","Menus")]})};AuIt.Action.Menus.CREATETEMPLATE={itemId:"MENUS_CREATETEMPLATE"};AuIt.Action.Menus.ADD={p:true,disabled:false,tooltip:AuIt.locale.Menus_ADDT,scale:"small",iconCls:"menu-mainmenu-16",itemId:"MENUS_ADD",updateState:function(a){}};AuIt.Action.Menus.EDIT={p:true,tooltip:AuIt.locale.Menus_EDITT,scale:"small",iconCls:"menu-edit-16",itemId:"MENUS_EDIT",disabled:true,updateState:function(a){if(a.source=="Gallery.Menus"){this.setDisabled(a.selections.length==0)}}};AuIt.Action.Menus.DEL={p:true,tooltip:AuIt.locale.Menus_DELT,scale:"small",iconCls:"menu-del-16",itemId:"MENUS_DEL",disabled:true,updateState:function(a){if(a.source=="Gallery.Menus"){this.setDisabled(a.selections.length==0)}}};AuIt.Editor.Gallery.Menus=Ext.extend(AuIt.Editor.Gallery.Container,{id:"AuIt.Editor.Gallery.Menus",title:AuIt.locale.Gallery_MenusT,getToolbar:function(){return AuIt.App.getActionMgr().getToolBar("GALLERY","Menus")},putMenus:function(a){AuIt.App.getActionMgr().request(a,{directCall:true,url:AUIT_EDITOR.web_cmd_url,waitMsg:true,caller:this,params:{action:"save_menus_template",data:AUIT_EDITOR.menus},LoadSuccess:function(b,c){if(b.menus){AUIT_EDITOR.menus=b.menus}c.caller.store.loadData(c.caller.getDataSource())}})},editBlock:function(b,a){AuIt.App.getActionMgr().request(b,{directCall:true,url:AUIT_EDITOR.web_cmd_url,waitMsg:true,waitWnd:this.el,params:{action:"menutag_definition",data:a},LoadSuccess:function(c,d){if(c.menutags){var f=Ext.ux.clone(a);f.menutags=c.menutags;f.storefield=c.storefield;var e=new AuIt.Editor.dlg.menusEditor({cfg:f});e.show()}}})},onCmd:function(e){switch(e.itemId){case"MENUS_ADD":var d={};this.editBlock(e,d);break;case"MENUS_CREATETEMPLATE":var a,f=AUIT_EDITOR.menus,b=[];Ext.applyIf(e.cfg,{menu:"",name:"",image:"",description:"",classname:""});var c=null;Ext.each(e.cfg.menutags,function(h){if(h[0]==e.cfg.reference){e.cfg.menu=h[1];return false}});delete (e.cfg.storefield);delete (e.cfg.menutags);if(e.cfg.key&&f[e.cfg.key]){c=e.cfg.key}else{for(a in f){if(f.hasOwnProperty(a)){if(f[a].name==e.cfg.name&&f[a].menu==e.cfg.menu){c=a;break}}}}if(!c){c=(new Date()).getTime()}if(Ext.isArray(AUIT_EDITOR.menus)){var g={};for(a in AUIT_EDITOR.menus){if(f.hasOwnProperty(a)){g[a]=AUIT_EDITOR.menus[a]}}AUIT_EDITOR.menus=g}AUIT_EDITOR.menus[c]=e.cfg;this.putMenus(e);break;case"MENUS_EDIT":var d=this.getSelectedRecord();if(d){this.editBlock(e,d)}break;case"MENUS_DEL":var d=this.getSelectedRecord();if(d){Ext.MessageBox.show({title:AuIt.locale.Gallery_Menus_DT,msg:AuIt.locale.Gallery_Menus_DM,buttons:Ext.MessageBox.YESNO,fn:function(j){if(j=="yes"){var i=null;var h,k=AUIT_EDITOR.menus;for(h in k){if(k.hasOwnProperty(h)){if(k[h].name==d.name&&k[h].menu==d.menu){i=h;break}}}if(i){k[i]=null;delete k[i]}this.putMenus(e)}},scope:this,icon:Ext.MessageBox.QUESTION})}break}},onClick:function(a){},getDataSource:function(){return AuIt.Editor.Gallery.Menus.superclass.getDataSource.call(this,AUIT_EDITOR.menus)},onSelectionChange:function(a){AuIt.App.getActionMgr().updateState({source:"Gallery.Menus",selections:a})}});