var select={};(function(){select.ie_selection=document.selection&&document.selection.createRangeCollection;function e(j,k){while(j&&j.parentNode!=k){j=j.parentNode}return j}function i(j,k){while(!j.previousSibling&&j.parentNode!=k){j=j.parentNode}return e(j.previousSibling,k)}var f="\u00a0\u00a0\u00a0\u00a0";select.scrollToNode=function(m){if(!m){return}var z=m.ownerDocument,p=z.body,q=(z.defaultView||z.parentWindow),o=z.documentElement,r=!m.nextSibling||!m.nextSibling.nextSibling||!m.nextSibling.nextSibling.nextSibling;var w=0;while(m&&!m.offsetTop){w++;m=m.previousSibling}if(w==0){r=false}var t=w*(m?m.offsetHeight:0),v=0,s=m;while(s&&s.offsetParent){t+=s.offsetTop;if(s.nodeName!="BR"){v+=s.offsetLeft}s=s.offsetParent}var k=p.scrollLeft||o.scrollLeft||0,j=p.scrollTop||o.scrollTop||0,n=v-k,l=t-j,u=false;if(n<0||n>(q.innerWidth||o.clientWidth||0)){k=v;u=true}if(l<0||r||l>(q.innerHeight||o.clientHeight||0)-50){j=r?10000000000:t;u=true}if(u){q.scrollTo(k,j)}};select.scrollToCursor=function(j){select.scrollToNode(select.selectionTopNode(j,true)||j.firstChild)};var c=null;select.snapshotChanged=function(){if(c){c.changed=true}};select.snapshotReplaceNode=function(n,m,k,l){if(!c){return}function j(o){if(n==o.node){c.changed=true;if(k&&o.offset>k){o.offset-=k}else{o.node=m;o.offset+=(l||0)}}}j(c.start);j(c.end)};select.snapshotMove=function(o,n,m,k,l){if(!c){return}function j(p){if(o==p.node&&(!l||p.offset==0)){c.changed=true;p.node=n;if(k){p.offset=Math.max(0,p.offset+m)}else{p.offset=m}}}j(c.start);j(c.end)};if(select.ie_selection){function g(n,j){var m=n.document.selection.createRange();m.collapse(j);function o(t){var u=null;while(!u&&t){u=t.nextSibling;t=t.parentNode}return l(u)}function l(t){while(t&&t.firstChild){t=t.firstChild}return{node:t,offset:0}}var s=m.parentElement();if(!isAncestor(n.document.body,s)){return null}if(!s.firstChild){return l(s)}var p=m.duplicate();p.moveToElementText(s);p.collapse(true);for(var q=s.firstChild;q;q=q.nextSibling){if(q.nodeType==3){var r=q.nodeValue.length;p.move("character",r)}else{p.moveToElementText(q);p.collapse(false)}var k=m.compareEndPoints("StartToStart",p);if(k==0){return o(q)}if(k==1){continue}if(q.nodeType!=3){return l(q)}p.setEndPoint("StartToEnd",m);return{node:q,offset:r-p.text.length}}return o(s)}select.markSelection=function(l){c=null;var k=l.document.selection;if(!k){return}var m=g(l,true),j=g(l,false);if(!m||!j){return}c={start:m,end:j,window:l,changed:false}};select.selectMarked=function(){if(!c||!c.changed){return}var m=c.window,l=m.document;function k(o){var p=l.body.createTextRange(),q=o.node;if(!q){p.moveToElementText(c.window.document.body);p.collapse(false)}else{if(q.nodeType==3){p.moveToElementText(q.parentNode);var r=o.offset;while(q.previousSibling){q=q.previousSibling;r+=(q.innerText||"").length}p.move("character",r)}else{p.moveToElementText(q);p.collapse(true)}}return p}var n=k(c.start),j=k(c.end);n.setEndPoint("StartToEnd",j);n.select()};select.selectionTopNode=function(j,k){var q=j.ownerDocument.selection;if(!q){return false}var o=q.createRange(),r=o.duplicate();o.collapse(k);var p=o.parentElement();if(p&&isAncestor(j,p)){r.moveToElementText(p);if(o.compareEndPoints("StartToStart",r)==1){return e(p,j)}}function m(t,v){if(v.nodeType==3){var u=0,x=v.previousSibling;while(x&&x.nodeType==3){u+=x.nodeValue.length;x=x.previousSibling}if(x){try{t.moveToElementText(x)}catch(w){}t.collapse(false)}else{t.moveToElementText(v.parentNode)}if(u){t.move("character",u)}}else{t.moveToElementText(v)}}var k=0,n=j.childNodes.length-1;while(k<n){var s=Math.ceil((n+k)/2),l=j.childNodes[s];if(!l){return false}m(r,l);if(o.compareEndPoints("StartToStart",r)==1){k=s}else{n=s-1}}return j.childNodes[k]||null};select.focusAfterNode=function(l,j){var k=j.ownerDocument.body.createTextRange();k.moveToElementText(l||j);k.collapse(!l);k.select()};select.somethingSelected=function(k){var j=k.document.selection;return j&&(j.createRange().text!="")};function a(m,k){var l=m.document.selection;if(l){var j=l.createRange();j.pasteHTML(k);j.collapse(false);j.select()}}select.insertNewlineAtCursor=function(j){a(j,"<br>")};select.insertTabAtCursor=function(j){a(j,f)};select.cursorPos=function(k,p){var n=k.ownerDocument.selection;if(!n){return null}var m=select.selectionTopNode(k,p);while(m&&m.nodeName!="BR"){m=m.previousSibling}var l=n.createRange(),j=l.duplicate();l.collapse(p);if(m){j.moveToElementText(m);j.collapse(false)}else{try{j.moveToElementText(k)}catch(o){return null}j.collapse(true)}l.setEndPoint("StartToStart",j);return{node:m,offset:l.text.length}};select.setCursorPos=function(k,n,m){function j(p){var o=k.ownerDocument.body.createTextRange();if(!p.node){o.moveToElementText(k);o.collapse(true)}else{o.moveToElementText(p.node);o.collapse(false)}o.move("character",p.offset);return o}var l=j(n);if(m&&m!=n){l.setEndPoint("EndToEnd",j(m))}l.select()};select.selectionCoords=function(m){var l=m.document.selection;if(!l){return null}var n=l.createRange(),k=n.duplicate();n.collapse(true);k.collapse(false);var j=m.document.body;return{start:{x:n.boundingLeft+j.scrollLeft-1,y:n.boundingTop+j.scrollTop},end:{x:k.boundingLeft+j.scrollLeft-1,y:k.boundingTop+j.scrollTop}}};select.selectCoords=function(n,l){if(!l){return}var k=n.document.body.createTextRange(),j=k.duplicate();try{k.moveToPoint(l.start.x,l.start.y);j.moveToPoint(l.end.x,l.end.y);k.setEndPoint("EndToStart",j);k.select()}catch(m){}}}else{select.markSelection=function(m){var l=m.getSelection();if(!l||l.rangeCount==0){return(c=null)}var k=l.getRangeAt(0);c={start:{node:k.startContainer,offset:k.startOffset},end:{node:k.endContainer,offset:k.endOffset},window:m,changed:false};function j(n){while(n.node.nodeType!=3&&n.node.nodeName!="BR"){var o=n.node.childNodes[n.offset]||n.node.nextSibling;n.offset=0;while(!o&&n.node.parentNode){n.node=n.node.parentNode;o=n.node.nextSibling}n.node=o;if(!o){break}}}j(c.start);j(c.end)};select.selectMarked=function(){if(!c||!c.changed){return}var l=c.window,k=l.document.createRange();function j(m,n){if(m.node){if(m.offset==0){k["set"+n+"Before"](m.node)}else{k["set"+n](m.node,m.offset)}}else{k.setStartAfter(l.document.body.lastChild||l.document.body)}}j(c.end,"End");j(c.start,"Start");h(k,l)};function h(j,l){var k=l.getSelection();k.removeAllRanges();k.addRange(j)}function b(k){var j=k.getSelection();if(!j||j.rangeCount==0){return false}else{return j.getRangeAt(0)}}select.selectionTopNode=function(j,n){var k=b(j.ownerDocument.defaultView);if(!k){return false}var l=n?k.startContainer:k.endContainer;var m=n?k.startOffset:k.endOffset;if(window.opera&&!n&&k.endContainer==j&&k.endOffset==k.startOffset+1&&j.childNodes[k.startOffset]&&j.childNodes[k.startOffset].nodeName=="BR"){m--}if(l.nodeType==3){if(m>0){return e(l,j)}else{return i(l,j)}}else{if(l.nodeName=="HTML"){return(m==1?null:j.lastChild)}else{if(l==j){return(m==0)?null:l.childNodes[m-1]}else{if(m==l.childNodes.length){return e(l,j)}else{if(m==0){return i(l,j)}else{return e(l.childNodes[m-1],j)}}}}}};select.focusAfterNode=function(l,j){var m=j.ownerDocument.defaultView,k=m.document.createRange();k.setStartBefore(j.firstChild||j);if(l&&!l.firstChild){k.setEndAfter(l)}else{if(l){k.setEnd(l,l.childNodes.length)}else{k.setEndBefore(j.firstChild||j)}}k.collapse(false);h(k,m)};select.somethingSelected=function(k){var j=b(k);return j&&!j.collapsed};function d(l,k){var j=b(l);if(!j){return}j.deleteContents();j.insertNode(k);webkitLastLineHack(l.document.body);j=l.document.createRange();j.selectNode(k);j.collapse(false);h(j,l)}select.insertNewlineAtCursor=function(j){d(j,j.document.createElement("BR"))};select.insertTabAtCursor=function(j){d(j,j.document.createTextNode(f))};select.cursorPos=function(j,m){var k=b(window);if(!k){return}var l=select.selectionTopNode(j,m);while(l&&l.nodeName!="BR"){l=l.previousSibling}k=k.cloneRange();k.collapse(m);if(l){k.setStartAfter(l)}else{k.setStartBefore(j)}return{node:l,offset:k.toString().length}};select.setCursorPos=function(j,o,n){var m=j.ownerDocument.defaultView,l=m.document.createRange();function k(s,v,q){if(!s){s=j.firstChild}else{s=s.nextSibling}if(!s){return}if(v==0){l["set"+q+"Before"](s);return true}var t=[];function p(w){if(w.nodeType==3){t.push(w)}else{forEach(w.childNodes,p)}}while(true){while(s&&!t.length){p(s);s=s.nextSibling}var u=t.shift();if(!u){return false}var r=u.nodeValue.length;if(r>=v){l["set"+q](u,v);return true}v-=r}}n=n||o;if(k(n.node,n.offset,"End")&&k(o.node,o.offset,"Start")){h(l,m)}}}})();