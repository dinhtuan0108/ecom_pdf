function makeWhiteSpace(c){var b=[],a=true;for(;c>0;c--){b.push((a||c==1)?nbsp:" ");a=!a}return b.join("")}function fixSpaces(a){if(a.charAt(0)==" "){a=nbsp+a.slice(1)}return a.replace(/\t/g,function(){return makeWhiteSpace(indentUnit)}).replace(/[ \u00a0]{2,}/g,function(b){return makeWhiteSpace(b.length)})}function cleanText(a){return a.replace(/\u00a0/g," ").replace(/\u200b/g,"")}function makePartSpan(b,c){var d=b;if(b.nodeType==3){d=b.nodeValue}else{b=c.createTextNode(d)}var a=c.createElement("SPAN");a.isPart=true;a.appendChild(b);a.currentText=d;return a}var webkitLastLineHack=webkit?function(a){var b=a.lastChild;if(!b||!b.isPart||b.textContent!="\u200b"){a.appendChild(makePartSpan("\u200b",a.ownerDocument))}}:function(){};var Editor=(function(){var g={P:true,DIV:true,LI:true};function b(l){var m=makeWhiteSpace(indentUnit);return map(l.replace(/\t/g,m).replace(/\u00a0/g," ").replace(/\r\n?/g,"\n").split("\n"),fixSpaces)}function d(n,m){var p=n.ownerDocument;var l=[];var q=true;function o(r,s){if(r.nodeType==3){var t=r.nodeValue=fixSpaces(r.nodeValue.replace(/[\r\u200b]/g,"").replace(/\n/g," "));if(t.length){q=false}l.push(r)}else{if(r.nodeName=="BR"&&r.childNodes.length==0){q=true;l.push(r)}else{forEach(r.childNodes,o);if(!q&&g.hasOwnProperty(r.nodeName)){q=true;if(!m||!s){l.push(p.createElement("BR"))}}}}}o(n,true);return l}function e(l){function m(y,z){o=z;return y}function t(z,y,A){return function(){return z(y,A)}}function u(){o=u;throw StopIteration}var o=t(v,l,u);var n=l.ownerDocument;var p=[];function s(A){var z=A.parentNode;var y=A.nextSibling;return function(B){z.insertBefore(B,y)}}var w=null;function q(y){var z="\n";if(y.nodeType==3){select.snapshotChanged();y=makePartSpan(y,n);z=y.currentText}y.dirty=true;p.push(y);w(y);return z}function r(A,B,y){var z=[];forEach(d(A,y),function(C){z.push(q(C))});return m(z.join(""),B)}function x(y){if(y.isPart&&y.childNodes.length==1&&y.firstChild.nodeType==3){y.currentText=y.firstChild.nodeValue;return !/[\n\t\r]/.test(y.currentText)}return false}function v(z,A){if(z.nextSibling){A=t(v,z.nextSibling,A)}if(x(z)){p.push(z);return m(z.currentText,A)}else{if(z.nodeName=="BR"){p.push(z);return m("\n",A)}else{var y=!z.nextSibling;w=s(z);removeElement(z);return r(z,A,y)}}}return{next:function(){return o()},nodes:p}}function h(l){if(l.nodeName=="BR"){return 1}else{return l.currentText.length}}function j(l){while(l&&l.nodeName!="BR"){l=l.previousSibling}return l}function k(m,l){if(!m){m=l.firstChild}else{if(m.nodeName=="BR"){m=m.nextSibling}}while(m&&m.nodeName!="BR"){m=m.nextSibling}return m}function c(){return new Date().getTime()}function i(o,n,m){this.editor=o;this.history=o.history;this.history.commit();this.atOccurrence=false;this.fallbackSize=15;var q;if(m&&(q=select.cursorPos(this.editor.container))){this.line=q.node;this.offset=q.offset}else{this.line=null;this.offset=0}this.valid=!!n;var p=n.split("\n"),l=this;this.matches=(p.length==1)?function(){var r=cleanText(l.history.textAfter(l.line).slice(l.offset)).indexOf(n);if(r>-1){return{from:{node:l.line,offset:l.offset+r},to:{node:l.line,offset:l.offset+r+n.length}}}}:function(){var u=cleanText(l.history.textAfter(l.line).slice(l.offset));var t=u.lastIndexOf(p[0]);if(t==-1||t!=u.length-p[0].length){return false}var r=l.offset+t;var s=l.history.nodeAfter(l.line);for(var v=1;v<p.length-1;v++){if(cleanText(l.history.textAfter(s))!=p[v]){return false}s=l.history.nodeAfter(s)}if(cleanText(l.history.textAfter(s)).indexOf(p[p.length-1])!=0){return false}return{from:{node:l.line,offset:r},to:{node:s,offset:p[p.length-1].length}}}}i.prototype={findNext:function(){if(!this.valid){return false}this.atOccurrence=false;var l=this;if(this.line&&!this.line.parentNode){this.line=null;this.offset=0}function n(o){if(l.history.textAfter(o.node).length>o.offset){l.line=o.node;l.offset=o.offset+1}else{l.line=l.history.nodeAfter(o.node);l.offset=0}}while(true){var m=this.matches();if(m){this.atOccurrence=m;n(m.from);return true}this.line=this.history.nodeAfter(this.line);this.offset=0;if(!this.line){this.valid=false;return false}}},select:function(){if(this.atOccurrence){select.setCursorPos(this.editor.container,this.atOccurrence.from,this.atOccurrence.to);select.scrollToCursor(this.editor.container)}},replace:function(m){if(this.atOccurrence){var l=this.editor.replaceRange(this.atOccurrence.from,this.atOccurrence.to,m);this.line=l.node;this.offset=l.offset;this.atOccurrence=false}}};function f(o){this.options=o;window.indentUnit=o.indentUnit;this.parent=parent;this.doc=document;var l=this.container=this.doc.body;this.win=window;this.history=new History(l,o.undoDepth,o.undoDelay,this,o.onChange);var n=this;if(!f.Parser){throw"No parser loaded."}if(o.parserConfig&&f.Parser.configure){f.Parser.configure(o.parserConfig)}if(!o.readOnly){select.setCursorPos(l,{node:null,offset:0})}this.dirty=[];if(o.content){this.importCode(o.content)}else{l.appendChild(this.doc.createElement("BR"))}if(!o.readOnly){if(o.continuousScanning!==false){this.scanner=this.documentScanner(o.passTime);this.delayScanning()}function p(){if(document.body.contentEditable!=undefined&&internetExplorer){document.body.contentEditable="true"}else{document.designMode="on"}document.documentElement.style.borderWidth="0";if(!o.textWrapping){l.style.whiteSpace="nowrap"}}try{p()}catch(r){var m=addEventHandler(document,"focus",function(){m();p()},true)}addEventHandler(document,"keydown",method(this,"keyDown"));addEventHandler(document,"keypress",method(this,"keyPress"));addEventHandler(document,"keyup",method(this,"keyUp"));function q(){n.cursorActivity(false)}addEventHandler(document.body,"mouseup",q);addEventHandler(document.body,"cut",q);addEventHandler(document.body,"paste",function(s){q();var u=null;try{var v=s.clipboardData||window.clipboardData;if(v){u=v.getData("Text")}}catch(t){}if(u!==null){n.replaceSelection(u);s.stop()}});addEventHandler(document.body,"beforepaste",method(this,"reroutePasteEvent"));if(this.options.autoMatchParens){addEventHandler(document.body,"click",method(this,"scheduleParenBlink"))}}else{if(!o.textWrapping){l.style.whiteSpace="nowrap"}}}function a(l){return(l>=16&&l<=18)||(l>=33&&l<=40)}f.prototype={importCode:function(l){this.history.push(null,null,b(l));this.history.reset()},getCode:function(){if(!this.container.firstChild){return""}var l=[];select.markSelection(this.win);forEach(e(this.container.firstChild),method(l,"push"));webkitLastLineHack(this.container);select.selectMarked();return cleanText(l.join(""))},checkLine:function(l){if(l===false||!(l==null||l.parentNode==this.container)){throw parent.CodeMirror.InvalidLineHandle}},cursorPosition:function(m){if(m==null){m=true}var l=select.cursorPos(this.container,m);if(l){return{line:l.node,character:l.offset}}else{return{line:null,character:0}}},firstLine:function(){return null},lastLine:function(){if(this.container.lastChild){return j(this.container.lastChild)}else{return null}},nextLine:function(m){this.checkLine(m);var l=k(m,this.container);return l||false},prevLine:function(l){this.checkLine(l);if(l==null){return false}return j(l.previousSibling)},selectLines:function(p,l,o,n){this.checkLine(p);var q={node:p,offset:l},m=null;if(n!==undefined){this.checkLine(o);m={node:o,offset:n}}select.setCursorPos(this.container,q,m);select.scrollToCursor(this.container)},lineContent:function(l){this.checkLine(l);var m=[];for(l=l?l.nextSibling:this.container.firstChild;l&&l.nodeName!="BR";l=l.nextSibling){m.push(nodeText(l))}return cleanText(m.join(""))},setLineContent:function(l,m){this.history.commit();this.replaceRange({node:l,offset:0},{node:l,offset:this.history.textAfter(l).length},m);this.addDirtyNode(l);this.scheduleHighlight()},insertIntoLine:function(s,m,n){var o=null;if(m=="end"){o=k(s,this.container)}else{for(var q=s?s.nextSibling:this.container.firstChild;q;q=q.nextSibling){if(m==0){o=q;break}var r=(q.innerText||q.textContent||q.nodeValue||"");if(r.length>m){o=q.nextSibling;n=r.slice(0,m)+n+r.slice(m);removeElement(q);break}m-=r.length}}var t=b(n),p=this.container.ownerDocument;for(var l=0;l<t.length;l++){if(l>0){this.container.insertBefore(p.createElement("BR"),o)}this.container.insertBefore(makePartSpan(t[l],p),o)}this.addDirtyNode(s);this.scheduleHighlight()},selectedText:function(){var m=this.history;m.commit();var p=select.cursorPos(this.container,true),l=select.cursorPos(this.container,false);if(!p||!l){return""}if(p.node==l.node){return m.textAfter(p.node).slice(p.offset,l.offset)}var n=[m.textAfter(p.node).slice(p.offset)];for(var o=m.nodeAfter(p.node);o!=l.node;o=m.nodeAfter(o)){n.push(m.textAfter(o))}n.push(m.textAfter(l.node).slice(0,l.offset));return cleanText(n.join("\n"))},replaceSelection:function(m){this.history.commit();var n=select.cursorPos(this.container,true),l=select.cursorPos(this.container,false);if(!n||!l){return}l=this.replaceRange(n,l,m);select.setCursorPos(this.container,l);webkitLastLineHack(this.container)},reroutePasteEvent:function(){if(this.capturingPaste||window.opera){return}this.capturingPaste=true;var m=parent.document.createElement("TEXTAREA");m.style.position="absolute";m.style.left="-500px";m.style.width="10px";m.style.top=nodeTop(frameElement)+"px";parent.document.body.appendChild(m);parent.focus();m.focus();var l=this;this.parent.setTimeout(function(){l.capturingPaste=false;l.win.focus();if(l.selectionSnapshot){l.win.select.selectCoords(l.win,l.selectionSnapshot)}var n=m.value;if(n){l.replaceSelection(n)}removeElement(m)},10)},replaceRange:function(q,p,o){var n=b(o);n[0]=this.history.textAfter(q.node).slice(0,q.offset)+n[0];var m=n[n.length-1];n[n.length-1]=m+this.history.textAfter(p.node).slice(p.offset);var l=this.history.nodeAfter(p.node);this.history.push(q.node,l,n);return{node:this.history.nodeBefore(l),offset:m.length}},getSearchCursor:function(m,l){return new i(this,m,l)},reindent:function(){if(this.container.firstChild){this.indentRegion(null,this.container.lastChild)}},reindentSelection:function(m){if(!select.somethingSelected(this.win)){this.indentAtCursor(m)}else{var n=select.selectionTopNode(this.container,true),l=select.selectionTopNode(this.container,false);if(n===false||l===false){return}this.indentRegion(n,l,m)}},grabKeys:function(l,m){this.frozen=l;this.keyFilter=m},ungrabKeys:function(){this.frozen="leave";this.keyFilter=null},setParser:function(l){f.Parser=window[l];if(this.container.firstChild){forEach(this.container.childNodes,function(m){if(m.nodeType!=3){m.dirty=true}});this.addDirtyNode(this.firstChild);this.scheduleHighlight()}},keyDown:function(n){if(this.frozen=="leave"){this.frozen=null}if(this.frozen&&(!this.keyFilter||this.keyFilter(n.keyCode))){n.stop();this.frozen(n);return}var m=n.keyCode;this.delayScanning();if(this.options.autoMatchParens){this.scheduleParenBlink()}if(m==13){if(n.ctrlKey&&!n.altKey){this.reparseBuffer()}else{select.insertNewlineAtCursor(this.win);this.indentAtCursor();select.scrollToCursor(this.container)}n.stop()}else{if(m==9&&this.options.tabMode!="default"){this.handleTab(!n.ctrlKey&&!n.shiftKey);n.stop()}else{if(m==32&&n.shiftKey&&this.options.tabMode=="default"){this.handleTab(true);n.stop()}else{if(m==36&&!n.shiftKey&&!n.ctrlKey){if(this.home()){n.stop()}}else{if((m==219||m==221)&&n.ctrlKey&&!n.altKey){this.blinkParens(n.shiftKey);n.stop()}else{if(n.metaKey&&!n.shiftKey&&(m==37||m==39)){var o=select.selectionTopNode(this.container);if(o===false||!this.container.firstChild){return}if(m==37){select.focusAfterNode(j(o),this.container)}else{var l=k(o,this.container);select.focusAfterNode(l?l.previousSibling:this.container.lastChild,this.container)}n.stop()}else{if((n.ctrlKey||n.metaKey)&&!n.altKey){if((n.shiftKey&&m==90)||m==89){select.scrollToNode(this.history.redo());n.stop()}else{if(m==90||(safari&&m==8)){select.scrollToNode(this.history.undo());n.stop()}else{if(m==83&&this.options.saveFunction){this.options.saveFunction();n.stop()}}}}}}}}}}},keyPress:function(n){var l=f.Parser.electricChars,m=this;if((this.frozen&&(!this.keyFilter||this.keyFilter(n.keyCode)))||n.code==13||(n.code==9&&this.options.tabMode!="default")||(n.keyCode==32&&n.shiftKey&&this.options.tabMode=="default")){n.stop()}else{if(l&&l.indexOf(n.character)!=-1){this.parent.setTimeout(function(){m.indentAtCursor(null)},0)}else{if((n.character=="v"||n.character=="V")&&(n.ctrlKey||n.metaKey)&&!n.altKey){this.reroutePasteEvent()}}}},keyUp:function(l){this.cursorActivity(a(l.keyCode))},indentLineAfter:function(s,p){var q=s?s.nextSibling:this.container.firstChild;if(q&&!hasClass(q,"whitespace")){q=null}var l=q?q.nextSibling:(s?s.nextSibling:this.container.firstChild);var n=(s&&l&&l.currentText)?l.currentText:"";var m=0,r=q?q.currentText.length:0;if(p!=null&&this.options.tabMode=="shift"){m=p?r+indentUnit:Math.max(0,r-indentUnit)}else{if(s){m=s.indentation(n,r,p)}else{if(f.Parser.firstIndentation){m=f.Parser.firstIndentation(n,r,p)}}}var o=m-r;if(o<0){if(m==0){if(l){select.snapshotMove(q.firstChild,l.firstChild,0)}removeElement(q);q=null}else{select.snapshotMove(q.firstChild,q.firstChild,o,true);q.currentText=makeWhiteSpace(m);q.firstChild.nodeValue=q.currentText}}else{if(o>0){if(q){q.currentText=makeWhiteSpace(m);q.firstChild.nodeValue=q.currentText}else{q=makePartSpan(makeWhiteSpace(m),this.doc);q.className="whitespace";if(s){insertAfter(q,s)}else{this.container.insertBefore(q,this.container.firstChild)}}if(l){select.snapshotMove(l.firstChild,q.firstChild,r,false,true)}}}if(o!=0){this.addDirtyNode(s)}return q},highlightAtCursor:function(){var m=select.selectionTopNode(this.container,true);var l=select.selectionTopNode(this.container,false);if(m===false||l===false){return}select.markSelection(this.win);if(this.highlight(m,k(l,this.container),true,20)===false){return false}select.selectMarked();return true},handleTab:function(l){if(this.options.tabMode=="spaces"){select.insertTabAtCursor(this.win)}else{this.reindentSelection(l)}},home:function(){var m=select.selectionTopNode(this.container,true),n=m;if(m===false||!(!m||m.isPart||m.nodeName=="BR")||!this.container.firstChild){return false}while(m&&m.nodeName!="BR"){m=m.previousSibling}var l=m?m.nextSibling:this.container.firstChild;if(l&&l!=n&&l.isPart&&hasClass(l,"whitespace")){select.focusAfterNode(l,this.container)}else{select.focusAfterNode(m,this.container)}select.scrollToCursor(this.container);return true},scheduleParenBlink:function(){if(this.parenEvent){this.parent.clearTimeout(this.parenEvent)}var l=this;this.parenEvent=this.parent.setTimeout(function(){l.blinkParens()},300)},blinkParens:function(w){if(!window.select){return}if(this.parenEvent){this.parent.clearTimeout(this.parenEvent)}this.parenEvent=null;function s(y){if(y.currentText){var x=y.currentText.match(/^[\s\u00a0]*([\(\)\[\]{}])[\s\u00a0]*$/);return x&&x[1]}}function p(x){return/[\(\[\{]/.test(x)}var l,u=this,t=select.selectionTopNode(this.container,true);if(!t||!this.highlightAtCursor()){return}t=select.selectionTopNode(this.container,true);if(!(t&&((l=s(t))||(t=t.nextSibling)&&(l=s(t))))){return}var r=t.className,n=p(l),o=matching[l];function q(){var x=[],z,y=true;for(var A=t;A;A=n?A.nextSibling:A.previousSibling){if(A.className==r&&A.nodeName=="SPAN"&&(z=s(A))){if(p(z)==n){x.push(z)}else{if(!x.length){y=false}else{if(x.pop()!=matching[z]){y=false}}}if(!x.length){break}}else{if(A.dirty||A.nodeName!="SPAN"&&A.nodeName!="BR"){return{node:A,status:"dirty"}}}}return{node:A,status:A&&y}}function m(y,x){y.style.fontWeight="bold";y.style.color=x?"#8F8":"#F88";u.parent.setTimeout(function(){y.style.fontWeight="";y.style.color=""},500)}while(true){var v=q();if(v.status=="dirty"){this.highlight(v.node,k(v.node));v.node.dirty=false;continue}else{m(t,v.status);if(v.node){m(v.node,v.status);if(w){select.focusAfterNode(v.node.previousSibling,this.container)}}break}}},indentAtCursor:function(m){if(!this.container.firstChild){return}if(!this.highlightAtCursor()){return}var o=select.selectionTopNode(this.container,false);if(o===false){return}var l=j(o);var n=this.indentLineAfter(l,m);if(o==l&&n){o=n}if(o==n){select.focusAfterNode(o,this.container)}},indentRegion:function(q,l,p){var o=(q=j(q)),n=q&&j(q.previousSibling);if(l.nodeName!="BR"){l=k(l,this.container)}do{var m=k(o,this.container);if(o){this.highlight(n,m,true)}this.indentLineAfter(o,p);n=o;o=m}while(o!=l);select.setCursorPos(this.container,{node:q,offset:0},{node:l,offset:0})},cursorActivity:function(l){if(internetExplorer){this.container.createTextRange().execCommand("unlink");this.selectionSnapshot=select.selectionCoords(this.win)}var m=this.options.cursorActivity;if(!l||m){var n=select.selectionTopNode(this.container,false);if(n===false||!this.container.firstChild){return}n=n||this.container.firstChild;if(m){m(n)}if(!l){this.scheduleHighlight();this.addDirtyNode(n)}}},reparseBuffer:function(){forEach(this.container.childNodes,function(l){l.dirty=true});if(this.container.firstChild){this.addDirtyNode(this.container.firstChild)}},addDirtyNode:function(m){m=m||this.container.firstChild;if(!m){return}for(var l=0;l<this.dirty.length;l++){if(this.dirty[l]==m){return}}if(m.nodeType!=3){m.dirty=true}this.dirty.push(m)},scheduleHighlight:function(){var l=this;this.parent.clearTimeout(this.highlightTimeout);this.highlightTimeout=this.parent.setTimeout(function(){l.highlightDirty()},this.options.passDelay)},getDirtyNode:function(){while(this.dirty.length>0){var l=this.dirty.pop();try{while(l&&l.parentNode!=this.container){l=l.parentNode}if(l&&(l.dirty||l.nodeType==3)){return l}}catch(m){}}return null},highlightDirty:function(n){if(!window.select){return}if(!this.options.readOnly){select.markSelection(this.win)}var o,m=n?null:c()+this.options.passTime;while((c()<m||n)&&(o=this.getDirtyNode())){var l=this.highlight(o,m);if(l&&l.node&&l.dirty){this.addDirtyNode(l.node)}}if(!this.options.readOnly){select.selectMarked()}if(o){this.scheduleHighlight()}return this.dirty.length==0},documentScanner:function(l){var m=this,n=null;return function(){if(!window.select){return}if(n&&n.parentNode!=m.container){n=null}select.markSelection(m.win);var o=m.highlight(n,c()+l,true);select.selectMarked();var p=o?(o.node&&o.node.nextSibling):null;n=(n==p)?null:p;m.delayScanning()}},delayScanning:function(){if(this.scanner){this.parent.clearTimeout(this.documentScan);this.documentScan=this.parent.setTimeout(this.scanner,this.options.continuousScanning)}},highlight:function(z,D,B,w){var u=this.container,v=this,q=this.options.activeTokens;var o=(typeof D=="number"?D:null);if(!u.firstChild){return}while(z&&(!z.parserFromHere||z.dirty)){if(w!=null&&z.nodeName=="BR"&&(--w)<0){return false}z=z.previousSibling}if(z&&!z.nextSibling){return}function r(F,E){return !E.reduced&&E.currentText==F.value&&E.className==F.style}function m(E,F){E.currentText=E.currentText.substring(F);E.reduced=true}function s(F){var E=makePartSpan(F.value,v.doc);E.className=F.style;return E}function A(F){if(F){var E=F.oldNextSibling;if(y||E===undefined||F.nextSibling!=E){v.history.touch(F)}F.oldNextSibling=F.nextSibling}else{var E=v.container.oldFirstChild;if(y||E===undefined||v.container.firstChild!=E){v.history.touch(null)}v.container.oldFirstChild=v.container.firstChild}}var n=e(z?z.nextSibling:u.firstChild),p=stringStream(n),t=z?z.parserFromHere(p):f.Parser.make(p);var x={current:null,get:function(){if(!this.current){this.current=n.nodes.shift()}return this.current},next:function(){this.current=null},remove:function(){u.removeChild(this.get());this.current=null},getNonEmpty:function(){var F=this.get();while(F&&F.nodeName=="SPAN"&&F.currentText==""){var E=F;this.remove();F=this.get();select.snapshotMove(E.firstChild,F&&(F.firstChild||F),0)}return F}};var y=false,C=true,l=0;forEach(t,function(G){var F=x.getNonEmpty();if(G.value=="\n"){if(F.nodeName!="BR"){throw"Parser out of sync. Expected BR."}if(F.dirty||!F.indentation){y=true}A(z);z=F;F.parserFromHere=t.copy();F.indentation=G.indentation;F.dirty=false;if(o==null&&F==D){throw StopIteration}if((o!=null&&c()>=o)||(!y&&!C&&l>1&&!B)){throw StopIteration}C=y;y=false;l=0;x.next()}else{if(F.nodeName!="SPAN"){throw"Parser out of sync. Expected SPAN."}if(F.dirty){y=true}l++;if(r(G,F)){F.dirty=false;x.next()}else{y=true;var E=s(G);u.insertBefore(E,F);if(q){q(E,G,v)}var J=G.value.length;var I=0;while(J>0){F=x.get();var H=F.currentText.length;select.snapshotReplaceNode(F.firstChild,E.firstChild,J,I);if(H>J){m(F,J);J=0}else{J-=H;I+=H;x.remove()}}}}});A(z);webkitLastLineHack(this.container);return{node:x.getNonEmpty(),dirty:y}}};return f})();addEventHandler(window,"load",function(){var a=window.frameElement.CodeMirror;a.editor=new Editor(a.options);this.parent.setTimeout(method(a,"init"),0)});