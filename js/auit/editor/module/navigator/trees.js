Ext.namespace("AuIt.Editor.Tree");AuIt.Editor.Tree.specialLinks=Ext.extend(Ext.tree.TreePanel,{iconCls:"page-cms-folder-16",border:false,useArrows:true,autoScroll:false,rootVisible:true,initComponent:function(){this.loader=new Ext.tree.TreeLoader({url:AUIT_EDITOR.special_tree_url+"?isAjax=true",baseParams:{store:0},listeners:{beforeload:{fn:function(c,a,b){c.baseParams.action="get-category";c.baseParams.form_key=FORM_KEY;c.baseParams.id=a.id},scope:this},load:{fn:function(a,c,b){},scope:this}}});AuIt.Editor.Tree.specialLinks.superclass.initComponent.call(this);this.root=this.setRootNode(new Ext.tree.AsyncTreeNode({text:AuIt.locale.Tree_specialT,expanded:true,id:"ROOT"}));this.on("click",this.onClick,this);AuIt.App.getActionMgr().on("cmd",function(e){var a,c,b,d;if(e.itemId=="PAGE_RELOAD"){a=e.window_id.split("_");c=a[0];b=a[1];if(c=="CMSPage"){if(e.itemId=="PAGE_RELOAD"){this.root.reload()}}}},this);this.getSelectionModel().on("selectionchange",function(b,a){AuIt.App.getActionMgr().updateState({source:"SPECIALTREE",sm:b,node:a})},this);AuIt.App.dragDrop.on("dragstart",this.onDragStart,this)},onDragStart:function(d){var i;if(i=d.event.getTarget(".x-tree-node-el",10)){var a=Ext.fly(i,"_treeEvents").getAttribute("tree-node-id","ext");if(a){var c=this.getNodeById(a);if(c&&c.attributes.allowDrag==1){var f=AuIt.App.getActiveEditor();var e=f?f.getActiveBlockPageData():{};var h=e.storeId;if(!c.attributes.stores[h]){return}var g=c.attributes.stores[h];d.allowed=true;var b=d.event.browserEvent.dataTransfer;b.setData("text/plain",g.name);b.setData("text/html",(AuIt.App.l!=1)?AuIt.locale.p:g.draghtml);b.setDragImage(c.ui.elNode,-10,-10);b.effectAllowed="copy";return false}}}},getClickUrl:function(b){var a=AUIT_EDITOR.base_store_id;if(!b.attributes.stores||!b.attributes.stores[a]){return""}var c=b.attributes.stores[a];return c.clickurl},onClick:function(b,c){var a=this.getClickUrl(b);if(a){AuIt.App.openWindow("CMSPage_"+b.attributes.id,a)}}});AuIt.Editor.Tree.cmsPage=Ext.extend(Ext.tree.TreePanel,{border:false,useArrows:true,autoScroll:false,rootVisible:true,initComponent:function(){if(this.shortMenu===true){}else{}this.loader=new Ext.tree.TreeLoader({url:AUIT_EDITOR.cms_tree_url+"?isAjax=true",baseParams:{store:0},listeners:{beforeload:{fn:function(c,a,b){c.baseParams.action="get-category";c.baseParams.form_key=FORM_KEY;c.baseParams.id=a.id},scope:this},load:{fn:function(a,c,b){b=Ext.decode(b.responseText);if(b&&b["0"]&&b["0"].navto){}},scope:this}}});AuIt.Editor.Tree.cmsPage.superclass.initComponent.call(this);this.root=this.setRootNode(new Ext.tree.AsyncTreeNode({text:AuIt.locale.Tree_cmsPageT,expanded:true,id:"ROOT"}));this.on("click",this.onClick,this);this.getSelectionModel().on("selectionchange",function(b,a){AuIt.App.getActionMgr().updateState({source:"CMSTREE",sm:b,node:a})},this);AuIt.App.getActionMgr().on("cmd",function(e){var a,c,b,d;if(e.itemId=="MAIN_TAB_CHANGE"||e.itemId=="CURRENT_TAB_CHANGED"){if(e.newTab){a=e.newTab.window_id.split("_");c=a[0];b=a[1];if(c=="CMSPage"){d=this.searchNode(this.root,b);if(d){this.getSelectionModel().select(d);return}}}this.getSelectionModel().clearSelections()}else{if(e.itemId=="PAGE_REMOVE"||e.itemId=="PAGE_RELOAD"){a=e.window_id.split("_");c=a[0];b=a[1];if(c=="CMSPage"){if(e.itemId=="PAGE_REMOVE"){d=this.searchNode(this.root,b);if(d){d=d.remove();d.destroy();d=null}}else{if(e.itemId=="PAGE_RELOAD"){this.root.reload(function(){if(b){d=this.searchNode(this.root,b);if(d){this.getSelectionModel().select(d)}}},this)}}}}}},this);AuIt.App.dragDrop.on("dragstart",this.onDragStart,this)},onDragStart:function(d){var a;if(a=d.event.getTarget(".x-tree-node-el",10)){var e=Ext.fly(a,"_treeEvents").getAttribute("tree-node-id","ext");if(e){var c=this.getNodeById(e);if(c&&c.attributes.allowDrag==1){d.allowed=true;var b=d.event.browserEvent.dataTransfer;if(b){b.setData("text/plain",c.attributes.text);b.setData("text/html",(AuIt.App.l!=1)?AuIt.locale.p:c.attributes.draghtml);b.setDragImage(c.ui.elNode,-10,-10);b.effectAllowed="copy";return false}}}}},getClickUrl:function(a){return a.attributes.clickurl},onClick:function(a,b){if(a.attributes.clickurl){AuIt.App.openWindow("CMSPage_"+a.attributes.page_id,a.attributes.clickurl)}},searchNode:function(b,a){var c=null;b.eachChild(function(d){if(d.attributes.page_id==a){c=d;return false}c=this.searchNode(d,a);if(c){return false}},this);return c}});AuIt.Editor.Tree.category=Ext.extend(Ext.tree.TreePanel,{border:false,useArrows:true,autoScroll:false,rootVisible:true,initComponent:function(){this.loader=new Ext.tree.TreeLoader({url:AUIT_EDITOR.category_url+"?isAjax=true",baseParams:{store:0},listeners:{beforeload:{fn:function(c,a,b){c.baseParams.action="get-category";c.baseParams.form_key=FORM_KEY;c.baseParams.id=a.id;c.baseParams.storeID=a.ownerTree.root.attributes.storeID;return true},scope:this},load:{fn:function(a,c,b){b=Ext.decode(b.responseText);if(b&&b["0"]&&b["0"].navto){}},scope:this}}});AuIt.Editor.Tree.category.superclass.initComponent.call(this);this.root=this.setRootNode(new Ext.tree.AsyncTreeNode({text:AuIt.locale.Tree_categoryT,expanded:true,id:"ROOT"}));this.on("click",this.onClick,this);AuIt.App.getActionMgr().on("cmd",function(e){var a,c,b,d;if(e.itemId=="PAGE_RELOAD"){a=e.window_id.split("_");c=a[0];b=a[1];if(c=="CMSPage"){if(e.itemId=="PAGE_RELOAD"){this.root.reload()}}}},this);AuIt.App.dragDrop.on("dragstart",this.onDragStart,this)},onDragStart:function(d){var i;if(i=d.event.getTarget(".x-tree-node-el",10)){var a=Ext.fly(i,"_treeEvents").getAttribute("tree-node-id","ext");if(a){var c=this.getNodeById(a);if(c&&c.attributes.allowDrag==1){var f=AuIt.App.getActiveEditor();var e=f?f.getActiveBlockPageData():{};var h=e.storeId;if(!c.attributes.stores[h]){return}var g=c.attributes.stores[h];d.allowed=true;var b=d.event.browserEvent.dataTransfer;b.setData("text/plain",g.name);b.setData("text/html",(AuIt.App.l!=1)?AuIt.locale.p:g.draghtml);b.setDragImage(c.ui.elNode,-10,-10);b.effectAllowed="copy";return false}}}},getClickUrl:function(b){var a=AUIT_EDITOR.base_store_id;if(!b.attributes.stores||!b.attributes.stores[a]){return""}var c=b.attributes.stores[a];return c.clickurl},onClick:function(b,c){var a=this.getClickUrl(b);if(a){AuIt.App.openWindow("CMSPage_"+b.attributes.id,a)}}});