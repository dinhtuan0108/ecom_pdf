Ext.namespace("AuIt.Action.ToolBar.Blocks","AuIt.Action.Blocks","AuIt.Action.cms");AuIt.Action.cms.BLOCKS={text:AuIt.locale.cms_BLOCKSM,tooltip:AuIt.locale.cms_BLOCKST,disabled:false,executeCmd:function(){AuIt.Editor.Dialog.Blocks()},scale:"small",iconCls:"cms-new-16",itemId:"CMS_BLOCKS"};AuIt.Action.ToolBar.Blocks.GALLERY=function(a){return new Ext.Toolbar({items:[a.getAction("ADD","Blocks"),a.getAction("EDIT","Blocks"),"-",a.getAction("DEL","Blocks")]})};AuIt.Action.Blocks.CREATETEMPLATE={itemId:"BLOCKS_CREATETEMPLATE"};AuIt.Action.Blocks.ADD={p:true,disabled:false,tooltip:AuIt.locale.Blocks_ADDT,scale:"small",iconCls:"cms-new-16",itemId:"BLOCKS_ADD",updateState:function(a){}};AuIt.Action.Blocks.EDIT={p:true,tooltip:AuIt.locale.Blocks_EDIT,scale:"small",iconCls:"cms-edit-16",itemId:"BLOCKS_EDIT",disabled:true,updateState:function(a){if(a.source=="Gallery.Blocks"){this.setDisabled(a.selections.length==0)}}};AuIt.Action.Blocks.DEL={p:true,tooltip:AuIt.locale.Blocks_DEL,scale:"small",iconCls:"cms-del-16",itemId:"BLOCKS_DEL",disabled:true,updateState:function(a){if(a.source=="Gallery.Blocks"){this.setDisabled(a.selections.length==0)}}};AuIt.Editor.Gallery.Blocks=Ext.extend(AuIt.Editor.Gallery.Container,{id:"AuIt.Editor.Gallery.Blocks",title:AuIt.locale.Gallery_BlocksM,getToolbar:function(){return AuIt.App.getActionMgr().getToolBar("GALLERY","Blocks")},putBlocks:function(a){AuIt.App.getActionMgr().request(a,{directCall:true,url:AUIT_EDITOR.web_cmd_url,waitMsg:true,caller:this,params:{action:"save_blocks_template",data:AUIT_EDITOR.blocks},LoadSuccess:function(b,c){if(b.blocks){AUIT_EDITOR.blocks=b.blocks}c.caller.store.loadData(c.caller.getDataSource())}})},onDblClick:function(a){AuIt.App.getActionMgr().getAction("EDIT","Blocks").executeCmd()},editBlock:function(b,a){AuIt.App.getActionMgr().request(b,{directCall:true,url:AUIT_EDITOR.web_cmd_url,waitMsg:true,waitWnd:this.el,params:{action:"block_definition",data:a},LoadSuccess:function(c,d){if(c.staticblocks){var f=Ext.ux.clone(a);f.staticblocks=c.staticblocks;f.blockoption=c.blockoption;f.templates=c.templates;f.showat=c.showat;f.scheduleat=c.scheduleat;var e=new AuIt.Editor.dlg.blocksEditor({cfg:f});e.show()}}})},onCmd:function(e){switch(e.itemId){case"BLOCKS_ADD":var d={};this.editBlock(e,d);break;case"BLOCKS_CREATETEMPLATE":var a,f=AUIT_EDITOR.blocks,b=[];Ext.applyIf(e.cfg,{menu:"",name:"",image:"",description:"",classname:""});var c=null;Ext.each(e.cfg.blockoption,function(h){if(h[0]==e.cfg.reference){e.cfg.menu=h[1];return false}});delete (e.cfg.blockoption);delete (e.cfg.staticblocks);if(e.cfg.key&&f[e.cfg.key]){c=e.cfg.key}else{for(a in f){if(f.hasOwnProperty(a)){if(f[a].name==e.cfg.name&&f[a].menu==e.cfg.menu){c=a;break}}}}if(!c){c=(new Date()).getTime()}if(Ext.isArray(AUIT_EDITOR.blocks)){var g={};for(a in AUIT_EDITOR.blocks){if(f.hasOwnProperty(a)){g[a]=AUIT_EDITOR.blocks[a]}}AUIT_EDITOR.blocks=g}AUIT_EDITOR.blocks[c]=e.cfg;this.putBlocks(e);break;case"BLOCKS_EDIT":var d=this.getSelectedRecord();if(d){this.editBlock(e,d)}break;case"BLOCKS_DEL":var d=this.getSelectedRecord();if(d){Ext.MessageBox.show({title:AuIt.locale.Gallery_Blocks_DELT,msg:AuIt.locale.Gallery_Blocks_DELM,buttons:Ext.MessageBox.YESNO,fn:function(j){if(j=="yes"){var i=null;var h,k=AUIT_EDITOR.blocks;for(h in k){if(k.hasOwnProperty(h)){if(k[h].name==d.name&&k[h].menu==d.menu){i=h;break}}}if(i){k[i]=null;delete k[i]}this.putBlocks(e)}},scope:this,icon:Ext.MessageBox.QUESTION})}break}},onClick:function(a){},getDataSource:function(){return AuIt.Editor.Gallery.Blocks.superclass.getDataSource.call(this,AUIT_EDITOR.blocks)},onSelectionChange:function(a){AuIt.App.getActionMgr().updateState({source:"Gallery.Blocks",selections:a})}});