Ext.namespace("AuIt.Editor");AuIt.Editor.Base=Ext.extend(Ext.util.Observable,{defaultValue:(Ext.isOpera||Ext.isIE6)?"&#160;":"&#8203;",validationEvent:false,initialized:false,activated:false,initComponent:function(){AuIt.Editor.Base.superclass.initComponent.call(this);this.addEvents("initialize","activate")},deferFocus:function(){this.focus.defer(10,this)},getSelection:function(){if(!this.selection){this.selection=new AuIt.Editor.Selection(this)}return this.selection},focus:function(){try{var b=this.getContentElm();if(b){b.focus()}else{if(this.win){this.win.focus()}}}catch(a){alert(a)}},fireMouseEvent:function(e,b){var f=e;var d=e.ownerDocument;if(d.createEvent){var c=d.createEvent("MouseEvents");c.initMouseEvent("click",true,true,d.defaultView,1,0,0,0,0,false,false,false,false,0,null);f.dispatchEvent(c)}else{if(d.createEventObject){var a=d.createEventObject();f.fireEvent("on"+b,a)}}},onUndo:function(){},onRedo:function(){},onSave:function(){},onSaveAll:function(){},onCut:function(){},onPaste:function(){},onCopy:function(){},onDelete:function(){},onBeforePaste:function(){},onBeforeCur:function(){},onBeforeCopy:function(){},onAnkerClick:function(){},onDragEnd:function(){},initEditor:function(){try{Ext.EventManager.on(this.doc,{mousedown:this.onEditorEvent,mouseup:this.onEditorEvent,dblclick:this.onEditorEvent,click:this.onEditorEvent,keyup:this.onEditorEvent,cut:this.onCut,paste:this.onPaste,copy:this.onCopy,drop:this.onDragEnd,buffer:100,scope:this});if(Ext.isGecko){Ext.EventManager.on(this.doc,"keypress",this.applyCommand,this)}if(Ext.isIE||Ext.isWebKit||Ext.isOpera){Ext.EventManager.on(this.doc,"keydown",this.fixKeys,this)}this.initialized=true;this.fireEvent("initialize",this);this.doc.editorInitialized=true}catch(a){}},onEditorEvent:function(a){this.getSelection().checkFirstLine();this.updateToolbar(a&&a.keyCode,a)},relayCmd:function(b,a){(function(){this.focus();this.execCmd(b,a);this.updateToolbar(true)}).defer(10,this)},insertImage:function(f){var e=this.doc;var c=this.getSelection();var a=c.findParent("img");var g=(a==null)?false:true;if(!g){a=e.createElement("img")}var d=Ext.fly(a);var b=this.getContentElm().getWidth();d.on("load",function(h){if(h.target.clientWidth>b){var i=Ext.fly(h.target);i.setWidth(b)}},this);d.set({src:f});if(!g){c.insertNodeAtSelection(a)}this.focus();c.selectNode(a)},execCmd:function(c,b){try{switch(c){case"insertimage":this.insertImage(b);break;case"justifycenter":case"justifyleft":case"justifyright":case"justifyfull":var a=this.getSelection().getNode();if(a){a=a.getParentBlockNode();if(a){switch(c){case"justifycenter":a.setStyle({textAlign:"center"});break;case"justifyleft":a.setStyle({textAlign:"left"});break;case"justifyright":a.setStyle({textAlign:"right"});break;case"justifyfull":a.setStyle({textAlign:"full"});break}}}break;default:this.doc.execCommand(c,false,b===undefined?null:b);break}this.setModified()}catch(d){}},applyCommand:function(b){var d=this.getContentElm();if(!d){return}if(b.getKey()==b.ENTER&&!b.shiftKey){return}if(b.ctrlKey){var f=b.getCharCode(),a;if(f>0){f=String.fromCharCode(f);switch(f){case"e":this.getActionMgr().getAction("CMD_SOURCEEDIT","Editor").executeCmd();b.preventDefault();break;case"b":a="bold";break;case"i":a="italic";break;case"u":a="underline";break;case"s":if(b.shiftKey){this.onSaveAll()}else{this.onSave()}b.preventDefault();break;case"z":this.onUndo();b.preventDefault();break;case"y":this.onRedo();b.preventDefault();break}if(a){this.focus();this.execCmd(a);this.deferFocus();b.preventDefault()}}}},queryCommandState:function(a){try{return this.doc.queryCommandState(a)}catch(b){}},queryCommandEnabled:function(a){try{return this.doc.queryCommandEnabled(a)}catch(b){}return false},queryCommandSupported:function(a){try{return this.doc.queryCommandEnabled(a)}catch(b){}return false},queryCommandValue:function(a){try{return this.doc.queryCommandValue(a)}catch(b){}return false},applyInlineStyle:function(g,b){var h=this.getContentElm();if(!h){return}var k=this,f=this,d=f.dom,a,i={},c;g=g.toUpperCase();var e=Ext.ux.clone(b.style);for(style in e){if(e.hasOwnProperty(style)){e[style]=""}}this.focus();var j="GERTAFONT_"+Ext.id();this.doc.execCommand("FontName",false,j);h.select("font{fontFamily="+j+"}").each(function(m){m.select("span").each(function(n){n.setStyle(e)});var l=Ext.get(this.getDoc().createElement("span"));l.setStyle(b.style);l.dom.innerHTML=m.dom.innerHTML;l.insertBefore(m);m.remove()},this)}});