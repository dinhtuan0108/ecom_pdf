Ext.namespace("Ext.ux","Ext.ux.menu","Ext.ux.form");if(Ext.version.substr(0,1)=="2"){Ext.ux.menu.ColorItem=function(a){if(!a){a={}}a.style="width:350px;";Ext.ux.menu.ColorItem.superclass.constructor.call(this,new Ext.ux.ColorPicker(a),a);this.picker=this.component;this.addEvents("select");this.picker.on("render",function(b){b.getEl().swallowEvent("click")});this.picker.on("select",this.onSelect,this)};Ext.extend(Ext.ux.menu.ColorItem,Ext.menu.Adapter,{onSelect:function(b,a){this.fireEvent("select",this,a,b);Ext.ux.menu.ColorItem.superclass.handleClick.call(this)}});Ext.ux.menu.ColorMenu=function(a){Ext.ux.menu.ColorMenu.superclass.constructor.call(this,a);this.plain=true;var b=new Ext.ux.menu.ColorItem(a);this.add(b);this.picker=b.picker;this.relayEvents(b,["select"])};Ext.extend(Ext.ux.menu.ColorMenu,Ext.menu.Menu,{beforeDestroy:function(){this.picker.destroy()}})}else{Ext.ux.menu.ColorMenu=Ext.extend(Ext.menu.Menu,{enableScrolling:false,hideOnClick:true,initComponent:function(){Ext.apply(this,{plain:true,showSeparator:false,items:this.picker=new Ext.ux.ColorPicker(Ext.apply({style:"width:350px;"},this.initialConfig))});this.picker.purgeListeners();Ext.ux.menu.ColorMenu.superclass.initComponent.call(this);this.relayEvents(this.picker,["select"]);this.on("select",this.menuHide,this);if(this.handler){this.on("select",this.handler,this.scope||this)}},menuHide:function(){if(this.hideOnClick){this.hide(true)}}})}Ext.ux.form.ColorPickerField=Ext.extend(Ext.form.TriggerField,{initComponent:function(){Ext.ux.form.ColorPickerField.superclass.initComponent.call(this);this.menu=new Ext.ux.menu.ColorMenu()},getValue:function(){if(this.value){return"#"+this.value}return""},setValue:function(a){if(a[0]=="#"){a=a.substr(1)}if(/^[0-9a-fA-F]{6}$/.test(a)){Ext.ux.form.ColorPickerField.superclass.setValue.apply(this,arguments);var b=this.menu.picker.rgbToHex(this.menu.picker.invert(this.menu.picker.hexToRgb(a)));this.el.applyStyles("background: #"+a+"; color: #"+b+";")}else{Ext.ux.form.ColorPickerField.superclass.setValue.call(this,"")}},onDestroy:function(){if(this.menu){this.menu.destroy()}if(this.wrap){this.wrap.remove()}Ext.ux.form.ColorPickerField.superclass.onDestroy.call(this)},onBlur:function(){Ext.ux.form.ColorPickerField.superclass.onBlur.call(this);var a=this.value;if(/^[0-9a-fA-F]{6}$/.test(a)){var b=this.menu.picker.rgbToHex(this.menu.picker.invert(this.menu.picker.hexToRgb(a)));this.el.applyStyles("background: #"+a+"; color: #"+b+";")}else{this.el.applyStyles("background: #ffffff; color: #000000;")}},menuListeners:{select:function(a,b){this.setValue(b);this.fireEvent("select",this,b);this.focus.defer(10,this)},show:function(a){this.onFocus()},hide:function(){this.focus.defer(10,this);var a=this.menuListeners;this.menu.un("select",a.select,this);this.menu.un("show",a.show,this);this.menu.un("hide",a.hide,this)}},onTriggerClick:function(){if(this.disabled){return}this.menu.on(Ext.apply({},this.menuListeners,{scope:this}));this.menu.show(this.el,"tl-bl?");this.menu.picker.setColor(this.value)}});Ext.reg("colorpickerfield",Ext.ux.form.ColorPickerField);